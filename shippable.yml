language: node_js

env:
    global:
        # Contains DEV_DEPLOY_HOST, DEV_DEPLOY_USER, DEV_DEPLOY_PATH
        # variables encrypted via Shippable
        # /!\ Only use the main account for the hosting, as it's the only one allowing SSH!
        - secure: sDC9359474REUuUG1ZZjy765P2pCPEiZjFAQHE/QvYeDTLmXp1Wujjk3NZjzjF6etZzKgUA4S0vXlUDbLkWstJFVfiAWK1pliC2l31phwI8DsKrL3BfAlB3RSvbJF5dh5txb2GjbM+hhZX+bt33RcoRJNOaBfOuv9ZnI8NvpZtepvXKw+bliFMdJCvTo7wc25qVJEHU80KVtkKcoUCg0jD16guxBBED6AnFIip93xJnz+hYeNngAsTLCBwT4wzzA0MNJHgyL1Lr33pcVf6g1+zKUzdQxXQhIKCUBOeS20fIrJi9qOuVnkSXZocAuGEK0ZUYTf8A2xGsRIN04pfNiew==
        # Contains PROD_DEPLOY_HOST, PROD_DEPLOY_USER, PROD_DEPLOY_PATH
        # variables encrypted via Shippable
        # /!\ Only use the main account for the hosting, as it's the only one allowing SSH!
        - secure: WjuFtLSG/j2YAHkVVcPwWdwc2SnkIPbnT6/RbiKIMM4RUWqJjnmWkyEr3/kUUJTp+Dz2U40mn/LmvjhUbhFTmjvH2l9a1/LScFii2ochBVRP9CuoHr3t5CW1vGwHnMu++ge3nH6pjizaWhkfuqLMasrQlV+ifBjF84G47/6VcLekDhWtXC5Q7xJ36DqdZZWdPL+OfUQiIBIh4TgUTXGIFFb39UBgGyvEZ8OWEci/Ibmfc2gVYjSIgb5Wl7tUiTt8chZVMYlFTHwMd/J/eO3gtFshsgM22RkPAWlC4xCNbqBTyNXG2bJiCCVRj85Pgymn7rf+NfitF3wm+gRXaSYlcw==

build:
    # Build our custom Docker image with NodeJS + PHP as a pre step
    pre_ci:
        - docker build -t atari-legend:latest Docker/php

    # Start the custom image we've built just above
    pre_ci_boot:
        image_name: atari-legend
        image_tag: latest
        pull: false

    # Do the actual build / CI of the project
    ci:
        - shippable_retry npm install
        - npm run grunt

    # If the build succeeded and we're on the development branch,
    # sync all the file to the dev server
    on_success:
        - ./deploy.sh
