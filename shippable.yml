language: node_js

env:
    global:
        # Contains DEV_DEPLOY_HOST, DEV_DEPLOY_USER, DEV_DEPLOY_PATH
        # variables encrypted via Shippable
        # /!\ Only use the main account for the hosting, as it's the only one allowing SSH!
        - secure: Dic5OseiMRPIB685ZPI69vXeZ78kDvZCU44WhaOZTTZ/h5PyeetvnUHk/6Hbq+Mb84toGWJHxNpXlQoMys4jT727CNcxpdFmGM1HbrvCpaHGbJQM0nZlHPdS/ynLqUypRWBiUds9KDdAwCRjXATuOIpfP3uKt7yWuUe61a3EEMbofhcqjLDqqIAYDe2HaU/ZkVsc5QtfdlAExLK0PcvC77MnzX+dyPfIFhYiEWaF+SYvibByL0cUSntvj3ovM5S03kM85/4uR6mJ3BHJXX2PIFtwzxAygB71repNBS5hWbTpm7OfTypIQNdBZqxyh67gfAx2GybURxu/hf8U6oVTUA==
        # Contains PROD_DEPLOY_HOST, PROD_DEPLOY_USER, PROD_DEPLOY_PATH
        # variables encrypted via Shippable
        # /!\ Only use the main account for the hosting, as it's the only one allowing SSH!
        - secure: LZRQ1C8gXz0qR7m9QbGGsNLXIQXNJNoQgK1c6WuhVPHDUbjR5RygsPrm0n+hF9MkTxnMbKew8a+8cK7EcI89oozDa3J1qQTtxddZ+YAVxXQoQRIVHTGQfu9FUrCSYaKjtByFUrW1T7QNK7Vh1p3c/uC+HERanRNM7jIc9qFFhPhL3Awf7JnqynKO++uRl68ZjiRX0FxPtTDlV91Sw07iunRSQSPc8jASX9z7b9RuoLcQK5GMlEzr5PR9i1n2jRJlWCagkIZoT9pVgbxqFYrkLkJQ2xX3fFZhf8+JetasVcIeVXvYNvt7HfX58q+6r/G87xcSVdJ+PwYZAuOL3Je91A==

build:
    # Build our custom Docker image with NodeJS + PHP as a pre step
    pre_ci:
        - docker build -t atari-legend:latest Docker/php

    # Start the custom image we've built just above
    pre_ci_boot:
        image_name: atari-legend
        image_tag: latest
        pull: false

    # Do the actual build / CI of the project
    ci:
        - shippable_retry npm install
        - npm run grunt

    # If the build succeeded and we're on the development branch,
    # sync all the file to the dev server
    on_success:
        - ./deploy.sh
