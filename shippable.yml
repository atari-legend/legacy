language: node_js

env:
    global:
        # Contains DEV_DEPLOY_HOST, DEV_DEPLOY_USER, DEV_DEPLOY_PATH
        # variables encrypted via Shippable
        - secure: GxR6UudYqcM5tOqwrk4sfRGpjsIxbWfRxAGhPYwuf5qXyShuZBpxZyR6qvYHYpZKCAIWHuVr3sAUzQYXIcqShW6QJF8A3DqnM+ebO2+uocIyNL8eakqhwgKrnEGfi7NkqCfUrkSXFMSViWwSWbL8khqjjgXH+mx7tcRD3AYe8BhI4E1IrdpZPKH5Zlq49BiMHqacZjl9lT9Ovr+W8kkeZbX9KKBail9q9aN4GkuzsROdCyX0PzE2adK9EH5+/c/kLuXwCjWxTrZbvmb/oaEU2R3bz30xIy6ZJXY2NDAO3DDhZMfqpOOUfQ8cEB9cr69vTGg8FSzx6bakEBZQxJ9RdA==
        # Contains PROD_DEPLOY_HOST, PROD_DEPLOY_USER, PROD_DEPLOY_PATH
        # variables encrypted via Shippable
        - secure: PogbOEj9818JfqopqZ1mPVfsd4LaHx5PF2S09ef/It37blbQAfw1UWDCAXEnb6GWpXDldHo00ySNszYTbvZGpmzkf/b6uanaXg38wO/bmbl9905joWNYiD62Mya9rsCjZWIhmCQskO5VbcNn2u4OE0a/3yopXwv3o9/llTlNptHZwdyAoMFm3dbW0CRWCZWlgLGyUKtlTNWqSWszI9/9vTLx+Rdo9afJrqRZiXNPwIDAQ1NgxXSu0iFud7kLx051Ai5c88u7fa2wdvmF5/em1HnJBhhmmi2gFfpVLnT/UZ6onF7/jjgg7QMtBYVJH2X9wSkTrL2jx96KFrndU6UrhQ==

build:
    # Build our custom Docker image with NodeJS + PHP as a pre step
    pre_ci:
        - docker build -t atari-legend:latest Docker/php

    # Start the custom image we've built just above
    pre_ci_boot:
        image_name: atari-legend
        image_tag: latest
        pull: false

    # Do the actual build / CI of the project
    ci:
        - shippable_retry npm install
        - npm run grunt

    # If the build succeeded and we're on the development branch,
    # sync all the file to the dev server
    on_success:
        - ./deploy.sh
