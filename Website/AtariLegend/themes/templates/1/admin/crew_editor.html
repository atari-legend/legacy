{*
/***************************************************************************
                            crew_editor.html
*                           --------------------------
*   begin                : Sunday, August 28, 2005
*   copyright            : (C) 2005 Atari Legend
*   email                : admin@atarilegend.com
*
*   Id: crew_editor.html,v 0.10 2005/10/29 Silver
*   Id: crew_editor.html,v 0.20 2016/10/04 STG
*           - CPANEL 2.0
***************************************************************************/

************************************************************************************************
The main game page
************************************************************************************************
*}
{extends file='1/admin/frontpage.html'}

{block name=java_script}
<script>
$(function() {
    $but = $('#file_upload_user_detail');

    $("input:file[id=file_upload]").change(function() {
        document.getElementById('file_upload_user_detail').value = $(this).val();
    });
});

function crewinsert()
{
    JSnewcrew=document.forms["insertcrew"].newcrew.value;

    if (JSnewcrew=='')
    {
        alert('Please fill in a crew name');
    }
    else
    {
        // CONFIRM REQUIRES ONE ARGUMENT
        var message = "Are you sure you want to insert this crew into the database?";
        // CONFIRM IS BOOLEAN. THAT MEANS THAT
        // IT RETURNS TRUE IF 'OK' IS CLICKED
        // OTHERWISE IT RETURN FALSE
        var return_value = confirm(message);

        if (return_value !="0")
        {
            url="db_crew.php?new_crew="+JSnewcrew+"&action=insert_crew";
            location.href=url;
        }
    }
}

function CrewDelete(crew_select)
{
    // CONFIRM REQUIRES ONE ARGUMENT
    var message = "Are you sure you want to delete this crew????";
    // CONFIRM IS BOOLEAN. THAT MEANS THAT
    // IT RETURNS TRUE IF 'OK' IS CLICKED
    // OTHERWISE IT RETURN FALSE
    var return_value = confirm(message);

    if (return_value !="0")
    {
        url="db_crew.php?crew_select="+crew_select+"&action=delete_crew";
        location.href=url;
    }
}

function browseCrew(str) {
    if (str == "") {
        document.getElementById("crew_list").innerHTML = "";
        return;
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?&crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_browse&query="+str,true);
        xmlhttp.send();
    }
}

function searchCrew(str) {
    if (str == "") {
        str = "empty";
            xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }

    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_search&query="+str,true);
        xmlhttp.send();
    }
}

var clientPC = navigator.userAgent.toLowerCase(); // Get client info
var clientVer = parseInt(navigator.appVersion); // Get browser version

var is_ie = ((clientPC.indexOf("msie") != -1) && (clientPC.indexOf("opera") == -1));
var is_nav = ((clientPC.indexOf('mozilla')!=-1) && (clientPC.indexOf('spoofer')==-1)
                && (clientPC.indexOf('compatible') == -1) && (clientPC.indexOf('opera')==-1)
                && (clientPC.indexOf('webtv')==-1) && (clientPC.indexOf('hotjava')==-1));
var is_moz = 0;
var is_win = ((clientPC.indexOf("win")!=-1) || (clientPC.indexOf("16bit") != -1));
var is_mac = (clientPC.indexOf("mac")!=-1);

// Define the bbCode tags
bbtags = new Array('[b]','[/b]','[i]','[/i]','[u]','[/u]','[url]','[/url]','[mail]','[/mail]', '[hotspotUrl=#]', '[/hotspotUrl]', '[hotspot=]', '[/hotspot]');
bbcode = new Array();
imageTag = false;

function bbstyle(bbnumber, bbname) {

    var txtarea = eval('document.post.' + bbname);

    txtarea.focus();
    donotinsert = false;
    theSelection = false;
    bblast = 0;

    if (bbnumber == -1) { // Close all open tags & default button names
        while (bbcode[0]) {
            butnumber = arraypop(bbcode) - 1;
            txtarea.value += bbtags[butnumber + 1];
            buttext = eval('document.post.addbbcode' + butnumber + '.value');
            eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
        }
        imageTag = false; // All tags are closed including image tags :D
        txtarea.focus();
        return;
    }

    if ((clientVer >= 4) && is_ie && is_win)
    {
        theSelection = document.selection.createRange().text; // Get text selection
        if (theSelection) {
            // Add tags around selection
            document.selection.createRange().text = bbtags[bbnumber] + theSelection + bbtags[bbnumber+1];
            txtarea.focus();
            theSelection = '';
            return;
        }
    }
    else if (txtarea.selectionEnd && (txtarea.selectionEnd - txtarea.selectionStart > 0))
    {
        mozWrap(txtarea, bbtags[bbnumber], bbtags[bbnumber+1]);
        return;
    }

    // Find last occurance of an open tag the same as the one just clicked
    for (i = 0; i < bbcode.length; i++) {
        if (bbcode[i] == bbnumber+1) {
            bblast = i;
            donotinsert = true;
        }
    }

    if (donotinsert) {      // Close all open tags up to the one just clicked & default button names
        while (bbcode[bblast]) {
                butnumber = arraypop(bbcode) - 1;
                txtarea.value += bbtags[butnumber + 1];
                buttext = eval('document.post.addbbcode' + butnumber + '.value');
                eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
                imageTag = false;
            }
            txtarea.focus();
            return;
    } else { // Open tags

        if (imageTag && (bbnumber != 14)) {     // Close image tag before adding another
            txtarea.value += bbtags[15];
            lastValue = arraypop(bbcode) - 1;   // Remove the close image tag from the list
            document.post.addbbcode14.value = "Img";    // Return button back to normal state
            imageTag = false;
        }

        // Open tag
        txtarea.value += bbtags[bbnumber];
        if ((bbnumber == 14) && (imageTag == false)) imageTag = 1; // Check to stop additional tags after an unclosed image tag
        arraypush(bbcode,bbnumber+1);
        eval('document.post.addbbcode'+bbnumber+'.value += "*"');
        txtarea.focus();
        return;
    }
    storeCaret(txtarea);
}

// From http://www.massless.org/mozedit/
function mozWrap(txtarea, open, close)
{
    var selLength = txtarea.textLength;
    var selStart = txtarea.selectionStart;
    var selEnd = txtarea.selectionEnd;
    if (selEnd == 1 || selEnd == 2)
        selEnd = selLength;

    var s1 = (txtarea.value).substring(0,selStart);
    var s2 = (txtarea.value).substring(selStart, selEnd)
    var s3 = (txtarea.value).substring(selEnd, selLength);
    txtarea.value = s1 + open + s2 + close + s3;
    return;
}

// Insert at Claret position. Code from
// http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130
function storeCaret(textEl) {
    if (textEl.createTextRange) textEl.caretPos = document.selection.createRange().duplicate();
}
</script>
{/block}

{block name=title}Crew editor{/block}

{block name=left_tile}
<div class="standard_tile">
    <h1>CREW EDITOR </h1>
    <div class="standard_tile_line"></div>
    <div class="standard_table_center">
        <br>
        Search for crew:<br>
        <form action="../crew/crew_editor.php" method="get" name="post_menu_crew_set" id="menu_crew_set">
            <select name="crewbrowse" size="1" class="standard_select select_small" onchange="browseCrew(this.value)">
                <option value="" SELECTED>-</option>
                {html_options values=$az_value output=$az_output}
            </select>
            <input type="text" name="crewsearch" value="" onkeyup="searchCrew(this.value)" class="standard_tile_input_small">
            <br>
            <br>
            {* Ajax *}
            <div id="crew_list">
                <select name="crew_select" class="standard_select select_large">
                    <option value="" SELECTED>-</option>
                    {foreach from=$crew item=line}
                        {html_options values=$line.crew_id output=$line.crew_name}
                    {/foreach}
                </select>
            </div>
            <br>
            <br>
            <input type="submit" value="Select" class="quick_search_games_button">
        </form>
        <br>
        <div class="standard_tile_line"></div>
        <br>
        {* Add crew section *}
        Add new Crew to db:
        <form method="post" name="insertcrew">
            <input type="text" name="newcrew" value="" class="standard_tile_input_small">
            <br>
            <br>
            <input type="submit" value="Insert" class="quick_search_games_button" onClick="crewinsert(); return false;">
        </form>
    </div>
    <br>
</div>
<br>
{include file='1/admin/left_nav.html'}
{/block}

{block name=main_tile}
<div class="standard_tile">
    <h1>EDIT CREW</h1>
    <div class="standard_tile_line"></div>
    <div class="standard_tile_text">
        <div class="left_nav_section">
            In this section you can edit different aspects of the crew.
        </div>
        {if isset($crew_select.crew_name)}
            <br>
            {* Start crew editing table *}
            <div style="display:flex;justify-content: space-around;flex-wrap: wrap;">
                <b><a href="../crew/crew_editor.php?crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}" class="standard_tile_link">Main Edit</a></b>
                <b><a href="../crew/crew_genealogy.php?action=genealogy&amp;crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}" class="standard_tile_link">Genealogy</a></b>
                <b><a href="../crew/crew_genealogy.php?action=stats" class="standard_tile_link">Statistics</a></b>
                <b><a href="../crew/crew_genealogy.php?action=comment" class="standard_tile_link">Comments/Submissions</a></b>
            </div>
            {* START THE CREW MAIN EDIT *}
            <br>
            <br>
            <fieldset>
                <legend>Edit Crew</legend>
                <form action="../crew/db_crew.php" method="post" name="post" id="crew_edit">
                    <div style="text-align:left;">
                        <b>Name :</b>
                        <input type="text" name="crew_name" class="standard_tile_input_small" value="{if isset($crew_select.crew_name)}{$crew_select.crew_name}{/if}">
                        <br>
                        <br>
                        <b>History :</b>
                        <br>
                        <br>
                        <input type="button" accesskey= "b" name="addbbcode0" value="B" onclick="bbstyle(0,'textfield')">
                        <input type="button" accesskey= "u" name="addbbcode4" value="U" onclick="bbstyle(4,'textfield')">
                        <input type="button" accesskey= "i" name="addbbcode2" value="I" onclick="bbstyle(2,'textfield')">
                        <input type="button" accesskey="w" name="addbbcode6" value="URL" onClick="bbstyle(6,'textfield')">
                        <input type="button" accesskey="x" name="addbbcode8" value="@" onClick="bbstyle(8,'textfield')">
                        <br>
                        <textarea name="textfield" id="game_review_textfield" style="padding:0;" ONSELECT="javascript:storeCaret(this);" ONCLICK="javascript:storeCaret(this);" ONKEYUP="javascript:storeCaret(this);" ONCHANGE="javascript:storeCaret(this);" rows="8" >{$crew_select.crew_history}</textarea><br>
                        <br>
                        <input type="submit" value="Update" class="topbutton_cpanel_small">
                        <input type="button" value="Delete" class="topbutton_cpanel_small" onClick="CrewDelete({if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}); return false;">
                        <input type="hidden" name="action" value="update_main_info">
                        <input type="hidden" name="crew_select" id="crew_select5" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                        <input type="hidden" name="crewsearch" id="crewsearch5" value="{$tracking.crewsearch}">
                        <input type="hidden" name="crewbrowse" id="crewbrowse5" value="{$tracking.crewbrowse}">
                        <br>
                    </div>
                </form>
            </fieldset>
            <br/>
            <br/>
            {if (isset($crew_select.crew_logo) and $crew_select.crew_logo <> '')}
                <fieldset class="game_set">
                <legend class="links_legend">Crew Logo</legend>
                    <br>
                    <img src="../../includes/show_image.php?file={$crew_select.crew_logo}" class="user_stats_img" id="user_details_img_dark" style="display:inline;">
                    <br>
                    <br>
                    <form action="../crew/db_crew.php" method="post" name="crew_pic_delete" id="crew_pic_delete">
                    <input type="submit" name="inserter" value="Delete" onClick="deletelogo(); return false;" class="topbutton_cpanel_small">
                    <input type="hidden" name="action" value="delete_logo">
                    <input type="hidden" name="crew_select" id="crew_select6" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                    <input type="hidden" name="crewsearch" id="crewsearch6" value="{$tracking.crewsearch}">
                    <input type="hidden" name="crewbrowse" id="crewbrowse6" value="{$tracking.crewbrowse}">
                    </form>
                </fieldset>
            {else}
                <form action="../crew/db_crew.php" method="post" enctype="multipart/form-data" name="crew_pic" id="crew_pic">
                <fieldset class="game_set">
                <legend class="links_legend">Crew Logo</legend>
                    <!--<input type="file" name="crew_pic" accept="image/jpeg,image/x-png">-->
                    <label for="file_upload" class="file_upload">Select file</label>
                    <input id="file_upload" type="file" name="crew_pic" accept="image/jpeg,image/x-png">
                    <input type="text" class="standard_tile_input_small" id="file_upload_user_detail">&nbsp;
                    <br/>
                    <br/>
                    <input type="submit" name="inserter" value="Upload" class="topbutton_cpanel_small">
                </fieldset>
                <input type="hidden" name="action" value="add_logo">
                <input type="hidden" name="crew_select" id="crew_select7" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                <input type="hidden" name="crewsearch" id="crewsearch7" value="{$tracking.crewsearch}">
                <input type="hidden" name="crewbrowse" id="crewbrowse7" value="{$tracking.crewbrowse}">
                </form>
            {/if}
            {* END THE CREW MAIN EDIT *}
        {else}
            <br>
            <div class="standard_table_center"> Crew does not exist </div>
        {/if}
    </div>
</div>
{/block}
