{*
/***************************************************************************
                              menu_disk_list.tpl
*                            --------------------------
*   begin                : Sunday, August 28, 2005
*   copyright            : (C) 2005 Atari Legend
*   email                : admin@atarilegend.com
*
*   id : menus_list.html ,v 0.10 2016/08/29 ST Graveyard 22:41
*           - AL 2.0
*   Id : menus_list.html ,v 0.20 2017/02/07 STG
*           - adding authors
***************************************************************************/

************************************************************************************************
The main game page
************************************************************************************************
*}
{extends file='1/admin/frontpage.html'}
{block name=java_script}
<script type="text/javascript">
function OSDMessageDisplay(message) {
    $.notify_osd.create({
        "text": message, // notification message
        "icon": "../../../themes/styles/1/images/osd_icons/star.png", // icon path, 48x48
        "sticky": false, // if true, timeout is ignored
        "timeout": 4, // disappears after 6 seconds
        "dismissable": true // can be dismissed manually
    });
}

$(function () {
    $(".JSAttributeCategoryChange").change(function() {
        AttributeCategoryChange ();
        AttributeEditorClose();
    });
    $(".JSAddNewAttributeCategoryButton").click(function() {
        AddNewAttributeCategory ();
    });
    $(".JSAddNewAttributeTypeButton").click(function() {
        AddNewAttributeType ();
    });

});

$( document ).ajaxComplete(function() {
    $("#JSChangeAttributeCategoryNameButton").click(function() {
        AttributeCategoryNameChange ();
    });
    $(".JSDeleteAttributeCategoryButton").click(function() {
        $("#JSGenericModal").dialog({
            title: "Delete Category",
            open: $("#JSGenericModalText").text("Are you sure you want to delete this Category?"),
            resizable: false,
            height: 200,
            modal: true,
                buttons: {
                    "Delete title": function() {
                        $(this).dialog("close");
                        DeleteAttributeCategory();
                    },
                    Cancel: function() {
                        $(this).dialog("close");
                    }
                }
        });
    });
});

function AttributesEditorListen() {
$("#JSChangeAttributeTypeNameButton").click(function() {
    if ($("#JSAttributeTypeNameEdit").val() === "") {
        return;
    } else {
        var form_values = $("#attribute_type_name_edit").serialize();
        var attribute_type_id = $("#JSAttributeTypeNameChangeID").val();
        var new_attribute_name = $("#JSAttributeTypeNameEdit").val();
        $.ajax({
            // The URL for the request
            url: "db_attributes.php",
            data: form_values,
            type: "POST",
            dataType: "html",
            // Code to run if the request succeeds;
            success: function(html) {
                OSDMessageDisplay(html);
                $(".JSAttributeTypeID_" +attribute_type_id).html(new_attribute_name);
            }
        });
    }
})
}

$( document ).on('click',"[id^='edit_attributes_']", function() {
    var attribute_type_id = "";
    attribute_type_id = $(this).val();
    console.log(attribute_type_id);
    if ($(this).is(":checked")) {
        $(".JSAttributeTypeCheckbox").not(this).prop("checked", false);
        AttributeEditorOpen(attribute_type_id);
        console.log("Open " + attribute_type_id);
    } else {
        AttributeEditorClose();
        console.log("Close " + attribute_type_id);
    }
});

function AttributeCategoryNameChange () {
    if ($("#JSCategoryNameEdit").val() === "") {
        return;
    }
    else {
        var new_name = $("#JSCategoryNameEdit").val();
        $(".JSCategoryName").text(new_name);
        $("select.JSAttributeCategoryChange option:checked").text(new_name);

        var form_values = $("#category_name_edit").serialize();
        $.ajax({
            // The URL for the request
            url: "db_attributes.php",
            data: form_values,
            type: "POST",
            dataType: "html",
            // Code to run if the request succeeds;
            success: function(html) {
                OSDMessageDisplay(html);
            }
        });
    }
}

function AttributeCategoryChange () {
    var attribute_category_id = $(".JSAttributeCategoryChange").val();
    if (attribute_category_id === "-") {
        $("#AjaxAttributeTypeList").html("");
        return;
    }
    $.ajax({
        // The URL for the request
        url: "ajax_attributes.php",
        data: "action=switch_category&attribute_category_id=" + attribute_category_id,
        type: "GET",
        dataType: "html",
        // Code to run if the request succeeds;
        success: function(html) {
            $("#AjaxAttributeTypeList").html(html);
        }
    });
}

function AddNewAttributeCategory () {
    var category_name = $(".JSNewAttributeCategory").val();
    if (category_name !=="") {
        var form_values = $("#JSAttributeCategoryAddForm").serialize();
        $.ajax({
            // The URL for the request
            url: "db_attributes.php",
            data: form_values,
            type: "POST",
            dataType: "html",
            // Code to run if the request succeeds;
            success: function(html) {
                var ReturnHtml = html.split('[BRK]');
                $('.JSAttributeCategoryChange').append($("<option></option>")
                                .attr("value",ReturnHtml[1])
                                .text(category_name));
                OSDMessageDisplay(ReturnHtml[0]);
                $(".JSNewAttributeCategory").val("");
            }
        });
     }
}


function AddNewAttributeType () {
    var type_name = $(".JSNewAttributeType").val();
    if (type_name !=="") {
        var form_values = $("#JSAttributeTypeAddForm").serialize();
        $.ajax({
            // The URL for the request
            url: "db_attributes.php",
            data: form_values,
            type: "POST",
            dataType: "html",
            // Code to run if the request succeeds;
            success: function(html) {
                OSDMessageDisplay(html);
                $(".JSNewAttributeType").val("");
                if ($("#JSAttributeCategoryNameChangeID").val()==='1') {
                    AttributeCategoryChange ();
                }
            }
        });
     }
}

function DeleteAttributeCategory() {
    var form_values = $("#JSDeleteAtributeCategoryForm").serialize();
    $.ajax({
        // The URL for the request
        url: "db_attributes.php",
        data: form_values,
        type: "POST",
        dataType: "html",
        // Code to run if the request succeeds;
        success: function(html) {
            OSDMessageDisplay(html);
            $(".JSAttributeCategoryChange").val("1").attr("selected","selected");
            AttributeCategoryChange ();
        }
    });
}

function AttributeEditorOpen(attribute_type_id) {
    $.ajax({
        // The URL for the request
        url: "ajax_attributes_editor.php",
        data: "action=open_attributes_editor&attribute_type_id=" + attribute_type_id,
        type: "GET",
        dataType: "html",
        // Code to run if the request succeeds;
        success: function(html) {
            $("#AjaxAttributesEditor").html(html);
            AttributesEditorListen();
        }
    });
}

function AttributeEditorClose() {

    $.ajax({
        // The URL for the request
        url: "ajax_attributes_editor.php",
        data: "action=close_attributes_editor",
        type: "GET",
        dataType: "html",
        // Code to run if the request succeeds;
        success: function(html) {
            $("#AjaxAttributesEditor").html(html);
        }
    });
}
</script>
{/block}

{block name=title}Attributes Editor{/block}

{block name=left_tile}
<div class="standard_tile">
    <h1>ATTRIBUTES MENU</h1>
    <div class="standard_tile_line"></div>
    <div class="standard_table_center">
        <br>
        Select Attribute Category
        <form action="" method="get" name="post" id="category_switcher">
            <select name="JSAttributeCategorySwitcher" id="quick_search_pub_select" class="JSAttributeCategoryChange">
                <option value="-">-</option>
                {foreach from=$attribute_category item=line}
                    {html_options values=$line.attribute_category_id output=$line.attribute_category_name}
                {/foreach}
            </select>
        </form>
        <br>
        <div id="AjaxAttributeTypeList">

        </div>

    </div>
</div>
<br>

{/block}

{block name=main_tile}
<div id="JSGenericModal" title="Delete Title?" style="display:none;">
    <p>
        <span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
        <div id="JSGenericModalText">Are you sure?</div>
    </p>
</div>
<div class="standard_tile">
    <h1>ATTRIBUTES EDITOR</h1>
    <div class="standard_tile_line"></div>

    <div class="standard_tile_text">
        <div id="AjaxAttributesEditor">
        <div class="left_nav_section">
            This is the Attributes Editor where you can edit, add and delete all the different attributes.
            Here we can also work with the attributes from an overview scope, assigning attributes and so on.
            Over at the right side you will find options for adding new attributes categories and types.<br>
            <br>
            On the left side we can select which attributes to work on.
        </div>
        <br>
        <br>
        <div id="new_disk"></div>
        <br>

    </div>
    </div>
</div>
<br>
<br>
{/block}

{block name=right_tile}
<div class="standard_tile">
    <h1>ADD ATTRIBUTES</h1>
    <div class="standard_tile_line"></div>
    <div class="standard_table_center">
        <br>
        Add New Attribute Category
        <form action="" method="POST" name="post" id="JSAttributeCategoryAddForm">
            <input type="text" name="attribute_category_name" id="new_category_name" value="" class="standard_tile_input_small JSNewAttributeCategory"><br><br>
            <input type="hidden" name="action" value="add_new_attribute_category">
            <input type="button" value="Add" class="quick_search_games_button JSAddNewAttributeCategoryButton">
        </form>
        <br>
        <div class="standard_tile_line"></div>
        <br>
        Add New Attribute Type
        <form action="" method="POST" name="post" id="JSAttributeTypeAddForm">
            <input type="text" name="attribute_type_name" id="new_attribute_type_name" value="" class="standard_tile_input_small JSNewAttributeType"><br><br>
            <input type="hidden" name="action" value="add_new_attribute_type">
            <input type="button" value="Add" class="quick_search_games_button JSAddNewAttributeTypeButton">
        </form>
        <br>

        <br>
    </div>
</div>
    <br>
    {include file='1/main/tile_bug_report.html'}
{/block}
