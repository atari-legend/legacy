{*
/***************************************************************************
*                                interviews_edit.html
*                            --------------------------
*   begin                : Saturday, July 22 2005
*   copyright            : (C) 2005 Atari Legend
*   email                : maarten.martens@freebel.net
*   actual update        : created this page
*
*   Id: interviews_edit.html,v 0.10 2005/07/22 13:40 Gatekeeper
*   Id: interviews_edit.html,v 0.20 2016/08/02 23:03 Gatekeeper
*		- AL 2.0
*   Id: interviews_edit.html,v 0.21 2017/06/16 19:38 ST Graveyard
*                   added the [frontpage] functionality
*   Id: interviews_edit.html,v 0.22 2017/08/19 15:02 ST Graveyard
*                   removed the [frontpage] functionality --> Why was this necessary??
***************************************************************************/

///****************************************************************************************
// This is the sub template file to generate the interviews edit page
//****************************************************************************************
*}
{extends file='1/admin/frontpage.html'}

{block name=java_script}
<script type="text/javascript">

$(document).ready(function() {
    $( "#member_name" ).autocomplete({
        source: "../../../php/admin/common/autocomplete.php?extraParams=admin-user",
        minLength: 2,
        select: function (evt, ui) {
            $("#member_name").val(ui.item.label);
            $("#members").val(ui.item.value);
            // Prevent Autocomplete default behaviour of injecting the 'value' in the input field
            return false;
        },
    });

    $( "#individual_name" ).autocomplete({
        source: "../../../php/includes/autocomplete.php?extraParams=individual",
        minLength: 2,
        select: function (evt, ui) {
            console.log("select!");
            $("#individual_name").val(ui.item.label);
            $("#individual").val(ui.item.value);
            // Prevent Autocomplete default behaviour of injecting the 'value' in the input field
            return false;
        },
    });

});

function deletecomment(screenshot_id, interview_id)
{
	// CONFIRM REQUIRES ONE ARGUMENT
    var message = "Are you sure you want to delete the screenshot with its comment?";
    // CONFIRM IS BOOLEAN. THAT MEANS THAT
    // IT RETURNS TRUE IF 'OK' IS CLICKED
    // OTHERWISE IT RETURN FALSE
    var return_value = confirm(message);
	if (return_value !="0")
    {
      	url="db_interview.php?interview_id="+interview_id+"&screenshot_id="+screenshot_id+"&action=delete_screenshot_comment";
		location.href=url;
    }
}

function deleteinterview(interview_id)
{
	// CONFIRM REQUIRES ONE ARGUMENT
    var message = "Are you sure you want to delete this interview?";
    // CONFIRM IS BOOLEAN. THAT MEANS THAT
    // IT RETURNS TRUE IF 'OK' IS CLICKED
    // OTHERWISE IT RETURN FALSE
    var return_value = confirm(message);
	if (return_value !="0")
    {
      	url="db_interview.php?action=delete_interview&interview_id="+interview_id;
		location.href=url;
    }
}

var clientPC = navigator.userAgent.toLowerCase(); // Get client info
var clientVer = parseInt(navigator.appVersion); // Get browser version

var is_ie = ((clientPC.indexOf("msie") != -1) && (clientPC.indexOf("opera") == -1));
var is_nav = ((clientPC.indexOf('mozilla')!=-1) && (clientPC.indexOf('spoofer')==-1)
                && (clientPC.indexOf('compatible') == -1) && (clientPC.indexOf('opera')==-1)
                && (clientPC.indexOf('webtv')==-1) && (clientPC.indexOf('hotjava')==-1));
var is_moz = 0;

var is_win = ((clientPC.indexOf("win")!=-1) || (clientPC.indexOf("16bit") != -1));
var is_mac = (clientPC.indexOf("mac")!=-1);

// Helpline messages
b_help = "Bold text: [b]text[/b]  (alt+b)";
i_help = "Italic text: [i]text[/i]  (alt+i)";
u_help = "Underline text: [u]text[/u]  (alt+u)";
q_help = "Quote text: [quote]text[/quote]  (alt+q)";
h_help = "Insert URL: [url]http://url[/url] or [url=http://url]URL text[/url]";
e_help = "Insert email: [@]email address[/@] or [@=email]email text[/@]";
s_help = "Insert Hotspot Source: [hotspotUrl=#]";
t_help = "Insert Hotspot Target: [hotspot=#]";
x_help = "Set Smiley";

// Define the bbCode tags
bbtags = new Array('[b]','[/b]','[i]','[/i]','[u]','[/u]','[url]','[/url]','[mail]','[/mail]', '[hotspotUrl=#]', '[/hotspotUrl]', '[hotspot=]', '[/hotspot]','[frontpage]','[/frontpage]');
bbcode = new Array();
imageTag = false;

// Shows the help messages in the helpline window
function helpline(help) {
	document.post.helpbox.value = eval(help + "_help");
}

function bbstyle(bbnumber, bbname) {

	var txtarea = eval('document.post.' + bbname);

	txtarea.focus();
	donotinsert = false;
	theSelection = false;
	bblast = 0;

	if (bbnumber == -1) { // Close all open tags & default button names
		while (bbcode[0]) {
			butnumber = arraypop(bbcode) - 1;
			txtarea.value += bbtags[butnumber + 1];
			buttext = eval('document.post.addbbcode' + butnumber + '.value');
			eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
		}
		imageTag = false; // All tags are closed including image tags :D
		txtarea.focus();
		return;
	}

	if ((clientVer >= 4) && is_ie && is_win)
	{
		theSelection = document.selection.createRange().text; // Get text selection
		if (theSelection) {
			// Add tags around selection
			document.selection.createRange().text = bbtags[bbnumber] + theSelection + bbtags[bbnumber+1];
			txtarea.focus();
			theSelection = '';
			return;
		}
	}
	else if (txtarea.selectionEnd && (txtarea.selectionEnd - txtarea.selectionStart > 0))
	{
		mozWrap(txtarea, bbtags[bbnumber], bbtags[bbnumber+1]);
		return;
	}

	// Find last occurance of an open tag the same as the one just clicked
	for (i = 0; i < bbcode.length; i++) {
		if (bbcode[i] == bbnumber+1) {
			bblast = i;
			donotinsert = true;
		}
	}

	if (donotinsert) {		// Close all open tags up to the one just clicked & default button names
		while (bbcode[bblast]) {
				butnumber = arraypop(bbcode) - 1;
				txtarea.value += bbtags[butnumber + 1];
				buttext = eval('document.post.addbbcode' + butnumber + '.value');
				eval('document.post.addbbcode' + butnumber + '.value ="' + buttext.substr(0,(buttext.length - 1)) + '"');
				imageTag = false;
			}
			txtarea.focus();
			return;
	} else { // Open tags

		if (imageTag && (bbnumber != 14)) {		// Close image tag before adding another
			txtarea.value += bbtags[15];
			lastValue = arraypop(bbcode) - 1;	// Remove the close image tag from the list
			document.post.addbbcode14.value = "Img";	// Return button back to normal state
			imageTag = false;
		}

		// Open tag
		txtarea.value += bbtags[bbnumber];
		if ((bbnumber == 14) && (imageTag == false)) imageTag = 1; // Check to stop additional tags after an unclosed image tag
		arraypush(bbcode,bbnumber+1);
		eval('document.post.addbbcode'+bbnumber+'.value += "*"');
		txtarea.focus();
		return;
	}
	storeCaret(txtarea);
}

// From http://www.massless.org/mozedit/
function mozWrap(txtarea, open, close)
{
	var selLength = txtarea.textLength;
	var selStart = txtarea.selectionStart;
	var selEnd = txtarea.selectionEnd;
	if (selEnd == 1 || selEnd == 2)
		selEnd = selLength;

	var s1 = (txtarea.value).substring(0,selStart);
	var s2 = (txtarea.value).substring(selStart, selEnd)
	var s3 = (txtarea.value).substring(selEnd, selLength);
	txtarea.value = s1 + open + s2 + close + s3;
	return;
}

// Insert at Claret position. Code from
// http://www.faqts.com/knowledge_base/view.phtml/aid/1052/fid/130
function storeCaret(textEl) {
	if (textEl.createTextRange) textEl.caretPos = document.selection.createRange().duplicate();
}
</script>
{/block}

{block name=title}Edit Interviews - <a href="../individuals/individuals_edit.php?ind_id={$interview.interview_ind_id}" class="left_nav_links">{$interview.interview_ind_name}</a>{/block}

{block name=main_tile}
<div class="standard_tile" id="interviews_edit">
    <div class="help-tip">
        <p>
			This is where the actual interview is inserted in the database. Overhere you'll notice 3 main text boxes.
			<br>
            <br>
			<i><b>- Intro :</b></i> This is where you'll write a little introduction to the interview. This text is placed in the boxes of the main interview section of AL (and in the search results). Use the 'Frontpage' button to mark the text used in the 'who is it' tile on the website.
			<br>
            <br>
			<i><b>- Chapters :</b></i> This is a section especially created for chapters. Its a bit more complex. You just add as many chapters as you like.
            eg : <i>Introduction, It started back then...</i>These chapters should have some sort of hotspot. Therefor you should always select each chapter and press the hotspotsource button. It also necesarry to give each chapter a unique number (behind the # sign).
			This chapter can be link to a certain place in the actual interview section by selecting the place and pressing the hotspottarget button. And ofcourse adding the appropriate number.
			<br>
			<br>
			<i><b>- Interview :</b></i> This is where you'll add the actual interview text.
			<br>
			<br>
            You can add screenshots by pressing the link at the bottom of the screen. Once shots have been linked to an interview, they will appear in this screen with their own comment fields for you to fill out if needed.
            <br>
			<br>
			Remember that you have a lot of freedom regarding layout issues. Even the "enters" you place in a text field are translated to the AL page, so make something nice of it, will you? :-)
        </p>
    </div>
	{if isset($interview.interview_ind_name)}
	<h1>{$interview.interview_ind_name}</h1>
	<div class="standard_tile_line"></div>
	<div class="standard_tile_text">
		<div class="left_nav_section">
			At this page you can change an existing interview in the AL database. The screen might seem a little complex,
			therefor I suggest you first read the help provided with this section on the top right.
		</div>
		<br>
		<br>
		<form action="../interviews/db_interview.php" method="post" name="post">
			<fieldset>
				<legend>Preview interview</legend>
					<a href="../interviews/interviews_preview.php?interview_id={$interview.interview_id}" class="left_nav_link"> Preview </a> this interview<br>
			</fieldset>
			<br>
			<fieldset>
				<legend>Edit interview</legend>
				<br>
				<div style="display:inline-block;">
					<b>Written by : </b>
					<br>
                    <input type="text" id="member_name" value="{$interview.interview_author_name}" class="standard_tile_input_small">
                    <input type="hidden" name="members" id="members" value="{$interview.interview_author}">
				</div>
				<br>
				<br>
				<div style="display:inline-block;">
					<b>Individual :</b>
					<br>
                    <input type="text" id="individual_name" value="{$interview.interview_ind_name}" class="standard_tile_input_small">
                    <input type="hidden" name="individual" id="individual" value="{$interview.interview_ind_id}">
					<br>
					<br>
				</div>
				<div style="width:100%;">
					<div style="width:20%;"><b>Date :</b></div>
					<div style="width:200px;">{html_select_date time=$interview.interview_date start_year="2000"}</div>
				</div>
				<br>
				<br>
				<b>Intro :</b>
				<br>
				<input type="button" accesskey= "b" name="addbbcode0" value="B" onclick="bbstyle(0,'textintro')">
				<input type="button" accesskey= "u" name="addbbcode4" value="U" onclick="bbstyle(4,'textintro')">
				<input type="button" accesskey= "i" name="addbbcode2" value="I" onclick="bbstyle(2,'textintro')">
				<input type="button" accesskey="w" name="addbbcode6" value="URL" onClick="bbstyle(6,'textintro')">
				<input type="button" accesskey="x" name="addbbcode8" value="@" onClick="bbstyle(8,'textintro')">
                <!--<input type="button" accesskey="frontpage" name="addbbcode16" value="Frontpage" onClick="bbstyle(14,'textintro')">-->
				<textarea name="textintro" id="game_review_textfield" ONSELECT="javascript:storeCaret(this);" ONCLICK="javascript:storeCaret(this);" ONKEYUP="javascript:storeCaret(this);" ONCHANGE="javascript:storeCaret(this);" rows="5" style="padding-left:0px;">{$interview.interview_intro}</textarea>
				<br>
				<br>
				<b>Chapters :</b>
				<br>
				<input type="button" accesskey= "b" name="addbbcode0" value="B" onclick="bbstyle(0,'textchapters')">
				<input type="button" accesskey= "u" name="addbbcode4" value="U" onclick="bbstyle(4,'textchapters')">
				<input type="button" accesskey= "i" name="addbbcode2" value="I" onclick="bbstyle(2,'textchapters')">
				<input type="button" accesskey="w" name="addbbcode6" value="URL" onClick="bbstyle(6,'textchapters')">
				<input type="button" accesskey="x" name="addbbcode8" value="@" onClick="bbstyle(8,'textchapters')">
				<input type="button" accesskey= "s" name="addbbcode10" value="Hotspot Source" onclick="bbstyle(10,'textchapters')"/>
				<textarea name="textchapters" id="game_review_textfield" ONSELECT="javascript:storeCaret(this);" ONCLICK="javascript:storeCaret(this);" ONKEYUP="javascript:storeCaret(this);" ONCHANGE="javascript:storeCaret(this);" rows="5" style="padding-left:0px;">{$interview.interview_chapters}</textarea>
				<br>
				<br>
				<b>Interview :</b>
				<br>
				<input type="button" accesskey= "b" name="addbbcode0" value="B" onclick="bbstyle(0,'textfield')">
				<input type="button" accesskey= "u" name="addbbcode4" value="U" onclick="bbstyle(4,'textfield')">
				<input type="button" accesskey= "i" name="addbbcode2" value="I" onclick="bbstyle(2,'textfield')">
				<input type="button" accesskey="w" name="addbbcode6" value="URL" onClick="bbstyle(6,'textfield')">
				<input type="button" accesskey="x" name="addbbcode8" value="@" onClick="bbstyle(8,'textfield')"/>
				<input type="button" accesskey= "t" name="addbbcode12" value="Hotspot Target" onclick="bbstyle(12,'textfield')">
				<textarea name="textfield" id="game_review_textfield" ONSELECT="javascript:storeCaret(this);" ONCLICK="javascript:storeCaret(this);" ONKEYUP="javascript:storeCaret(this);" ONCHANGE="javascript:storeCaret(this);" rows="15" style="padding-left:0px;">{$interview.interview_text}</textarea>
			</fieldset>
			<br>
			<fieldset class="centered_fieldset">
				<legend>Screenshots</legend>
				<br>
				{if $screenshots_nr <> ''}
					{foreach from=$screenshots item=line}
						<img src="../../includes/show_image.php?file={$line.interview_screenshot}&amp;resize=200,null,null,null&amp;crop=null,null,null,null" alt="screenshot" style="display:inline;" class="game_screenshot_img">
						<br>
						<br>
						<input class="game_review_screenshot_text" type="text" name="inputfield[]" value="{$line.interview_screenshot_comment}">
						<br>
						<a href="javascript:deletecomment({$line.interview_screenshot_id},{$interview.interview_id})" class="left_nav_link">Delete Shot</a>
						<br>
						<br>
						<br>
					{/foreach}
					Want to add more screenshots? Go <a href="interviews_screenshots_add.php?interview_id={$interview.interview_id}" class="left_nav_link">here</a>!
				{else}
					There are currently no screenshots attached to this interview. Go to the <a href="interviews_screenshots_add.php?interview_id={$interview.interview_id}" class="left_nav_link">screenshot adding</a>
					page to link specific screenshots to this interview. Remember that you have to create an interview first before actually uploading screenshots!
				{/if}
				<br>
				<br>
				<input type="hidden" name="interview_id" value="{$interview.interview_id}">
				<input type="hidden" name="action" value="update_interview">
				<input type="submit" name="update" value="Update" class="topbutton_cpanel_small">
				<input type="button" name="delete" value="Delete" onclick="deleteinterview({$interview.interview_id})" class="topbutton_cpanel_small">
			</fieldset>
		</form>
		<br>
		{else}
			<h1>Interview edit</h1>
			<div class="standard_tile_line"></div>
			<div class="standard_tile_text">
				<div class="left_nav_section">
					Interview does not exist.
				</div>
			</div>
		{/if}
		<div class="standard_table_center"><a href="../interviews/interviews_main.php" class="standard_tile_link">back</a></div>
		<br>
	</div>
</div>
{/block}
