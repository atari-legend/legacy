{*
/***************************************************************************
*                           crew_genealogy.html
*                           --------------------------
*   begin                : Sunday, August 28, 2005
*   copyright            : (C) 2005 Atari Legend
*   email                : admin@atarilegend.com
*
*   Id: crew_genealogy.html,v 0.10 2005/10/29 Silver
*   Id: crew_genealogy.html,v 0.20 2016/10/04 STG
*           - CPANEL 2.0
*
***************************************************************************/

************************************************************************************************
The crew genealogy page
************************************************************************************************
*}
{extends file='1/admin/main.html'}

{block name=java_script}
<script>
function crewinsert()
{
    JSnewcrew=document.forms["insertcrew"].newcrew.value;

    if (JSnewcrew=='')
    {
        alert('Please fill in a crew name');
    }
    else
    {
        // CONFIRM REQUIRES ONE ARGUMENT
        var message = "Are you sure you want to insert this crew into the database?";
        // CONFIRM IS BOOLEAN. THAT MEANS THAT
        // IT RETURNS TRUE IF 'OK' IS CLICKED
        // OTHERWISE IT RETURN FALSE
        var return_value = confirm(message);

        if (return_value !="0")
        {
            url="db_crew.php?new_crew="+JSnewcrew+"&action=insert_crew";
            location.href=url;
        }
    }
}

function browseSubCrew(str2) {
    if (str2 == "") {
        $('sub_crew').html('');
        return;
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
            {
                document.getElementById("sub_crew").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_gen_browse&query="+str2,true);
        xmlhttp.send();
    }
}

function searchSubCrew(str) {
    if (str == "") {
        str = "empty";
            xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("sub_crew").innerHTML = xmlhttp.responseText;
            }
        }

    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("sub_crew").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_search&query="+str,true);
        xmlhttp.send();
    }
}

function browseCrew(str) {
    if (str == "") {
        document.getElementById("crew_list").innerHTML = "";
        return;
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_browse&query="+str,true);
        xmlhttp.send();
    }
}

function searchCrew(str) {
    if (str == "") {
        str = "empty";
            xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("crew_list").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=crew_search&query="+str,true);
        xmlhttp.send();
    }
}

function browseInd(str) {
    if (str == "") {
        document.getElementById("ind_member").innerHTML = "";
        return;
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("ind_member").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=ind_gen_browse&query="+str,true);
        xmlhttp.send();
    }
}

function searchInd(str) {
    if (str == "") {
        str = "empty";
            xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("ind_member").innerHTML = xmlhttp.responseText;
            }
        }
    } else {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("ind_member").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET","../crew/ajax_crew_search.php?crewsearch={$tracking.crewsearch}&crewbrowse={$tracking.crewbrowse}&action=ind_gen_search&query="+str,true);
        xmlhttp.send();
    }
}
</script>
{/block}

{block name=left_tile}
<div class="standard_tile">
    <h1>CREW EDITOR </h1>
    <div class="standard_tile_line"></div>
    <div class="standard_tile_text_center">
        <br>
        Search for crew:<br>
        <form action="../crew/crew_editor.php" method="get" name="post_menu_crew_set" id="menu_crew_set">
            <select name="crewbrowse" size="1" class="standard_select select_small" onchange="browseCrew(this.value)">
                <option value="" SELECTED>-</option>
                {html_options values=$az_value output=$az_output}
            </select>
            <input type="text" name="crewsearch" value="" onkeyup="searchCrew(this.value)" class="standard_input input_large">
            <br>
            <br>
            {* Ajax *}
            <div id="crew_list">
                <select name="crew_select" class="standard_select select_large">
                    <option value="" SELECTED>-</option>
                    {foreach from=$crew item=line}
                        {html_options values=$line.crew_id output=$line.crew_name}
                    {/foreach}
                </select>
            </div>
            <br>
            <br>
            <input type="submit" value="Select" class="primary_button">
        </form>
        <br>
        <div class="standard_tile_line"></div>
        <br>
        {* Add crew section *}
        Add new Crew to db:
        <form method="post" name="insertcrew">
            <input type="text" name="newcrew" value="" class="standard_input input_large">
            <br>
            <br>
            <input type="submit" value="Insert" class="primary_button" onClick="crewinsert(); return false;">
        </form>
    </div>
    <br>
</div>
<br>

{/block}

{block name=title}Crew editor - Genealogy{/block}

{block name=main_tile}
<div class="standard_tile">
    <h1>CREW GENEALOGY</h1>
    <div class="standard_tile_line"></div>
    <div class="standard_tile_padding">
        <div class="left_nav_section">
            This is the scene genealogy page for <b>{$crew_select.crew_name}</b>. Here we can add members to crews. We can add both indiviual members and subcrews.
        </div>
        <br>
        {* Start crew editing table *}
        <div style="display:flex;justify-content: space-around;flex-wrap: wrap;">
            <b><a href="../crew/crew_editor.php?crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}" class="standard_tile_link">Main Edit</a></b>
            <b><a href="../crew/crew_genealogy.php?action=genealogy&amp;crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}" class="standard_tile_link">Genealogy</a></b>
            <b><a href="../crew/crew_genealogy.php?action=stats" class="standard_tile_link">Statistics</a></b>
            <b><a href="../crew/crew_genealogy.php?action=comment" class="standard_tile_link">Comments/Submissions</a></b>
        </div>
        {* START THE CREW GENEALOGY EDIT *}
        <br>
        <br>
        <div class="main_company_container">
            <div class="child_edit_company text-center">
                <fieldset class="secondary_fieldset">
                    <legend class="primary_legend">Subcrew</legend>
                    <form action="../crew/db_crew.php" method="post" name="crew_gene2" id="crew_gene2">
                        <select class="standard_select select_small" onchange="browseSubCrew(this.value)">
                            <option value="" SELECTED>-</option>
                            {html_options values=$az_value output=$az_output}
                        </select>
                        <input type="text" name="crewsearch" value="" onkeyup="searchSubCrew(this.value)" class="standard_input input_large">
                        <br><br>
                        <div id="sub_crew">
                            <select name="sub_crew[]" class="standard_select select_large">
                                <option value="" SELECTED>-</option>
                                {foreach from=$crew_gene item=line}
                                    {if $line.crew_id <> $crew_select.crew_id}
                                        <option value="{$line.crew_id}">{$line.crew_name}</option>
                                    {/if}
                                {/foreach}
                            </select>
                        </div>
                        <br>
                        <input type="hidden" name="action" value="parent_crew">
                        <input type="hidden" name="parent_id" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                        <input type="hidden" name="crew_select" id="crew_select8" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                        <input type="hidden" name="crewsearch" id="crewsearch8" value="{$tracking.crewsearch}">
                        <input type="hidden" name="crewbrowse" id="crewbrowse8" value="{$tracking.crewbrowse}">
                        <input type="submit" value="Add" class="secondary_button">
                    </form>
                </fieldset>
            </div>
            <div class="child_edit_company text-center">
                <fieldset class="secondary_fieldset">
                    <legend class="primary_legend">Members</legend>
                    <form action="../crew/db_crew.php" method="post">
                        <select class="standard_select select_small" name="m1" onchange="browseInd(this.value)">
                            <option value="" SELECTED>-</option>
                            {html_options values=$az_value output=$az_output}
                        </select>
                        <input type="text" onkeyup="searchInd(this.value)" class="standard_input input_large">
                        <br><br>
                        <div id="ind_member">
                            <select name="ind_id" class="standard_select select_large">
                                <option value="" SELECTED>-</option>
                                {foreach from=$ind_gene item=line}
                                    <option value="{$line.ind_id}">{$line.ind_name}</option>
                                {/foreach}
                            </select>
                        </div>
                        <br>
                        <input type="hidden" name="action" value="add_member">
                        <input type="hidden" name="parent_id" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                        <input type="hidden" name="crew_select" id="crew_select8" value="{if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}">
                        <input type="hidden" name="crewsearch" id="crewsearch8" value="{$tracking.crewsearch}">
                        <input type="hidden" name="crewbrowse" id="crewbrowse8" value="{$tracking.crewbrowse}">
                        <input type="submit" value="Add" class="secondary_button">
                    </form>
                </fieldset>
            </div>
        </div>
        {* MEMBERS OF CREW *}
        <br>
        <div class="main_company_container">
            <div class="child_edit_company text-center">
                <fieldset class="secondary_fieldset">
                    <table class="primary_table_list table_md">
                        <tr>
                            <th class="w-80">SubCrews</th>
                            <th class="w-20"></th>
                        </tr>
                        {if isset($subcrew)}
                            {foreach from=$subcrew item=line}
                                <tr>
                                    <td>
                                        <a href="../crew/crew_editor.php?crewbrowse=&crewsearch=&crew_select={$line.crew_id}" class="standard_tile_link">{$line.crew_name}</a>
                                    </td>
                                    <td>
                                        <a href="../crew/db_crew.php?action=delete_subcrew&amp;crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}&amp;sub_crew_id={$line.sub_crew_id}" class="standard_tile_link">Delete</a>
                                    </td>
                                </tr>
                            {/foreach}
                        {/if}
                    </table>
                </fieldset>
            </div>
            <div class="child_edit_company text-center">
                <fieldset class="secondary_fieldset">
                    <table class="primary_table_list table_md">
                        <tr>
                            <th class="w-80">"Sceners"</th>
                            <th class="w-20"></th>
                        </tr>
                        {if isset($crew_individuals)}
                            {foreach name=outer item=individual from=$crew_individuals}
                                <tr>
                                    <td>
                                        <a href="../individuals/individuals_edit.php?ind_id={$individual.ind_id}" class="standard_tile_link">
                                            {$individual.ind_name}
                                        </a>
                                    </td>
                                    <td>
                                        <a href="../crew/db_crew.php?action=delete_crew_member&amp;crew_select={if isset($crew_select.crew_id)}{$crew_select.crew_id}{/if}&amp;crewsearch={$tracking.crewsearch}&amp;crewbrowse={$tracking.crewbrowse}&amp;crew_individual_id={$individual.crew_individual_id}" class="standard_tile_link">Delete</a>
                                    </td>
                                </tr>
                            {/foreach}
                        {/if}
                    </table>
                </fieldset>
            </div>
        </div>
    </div>
</div>
{* END THE CREW GENEALOGY EDIT *}
{/block}
