{* 
/***************************************************************************
*                                site_admin.html
*                            --------------------------
*   begin                : 2016-02-13
*   copyright            : (C) 2015 Atari Legend
*   email                : admin@atarilegend.com
*
*   Id: site_admin.html,v 0.1 Silver Surfer
*
***************************************************************************/
*}
{extends file='1/admin/frontpage.html'}
{block name=left_tile}

<div class="standard_tile" id="{$left_nav}">
	<h1>ADMIN NAVIGATION</h1>
		<div class="standard_tile_line"></div>
		<div class="standard_list_entry">
			<div class="standard_tile_text">
				<ul class="standard_table_list">
					<li class="left_nav_section">Administration Sections</li>

					<li><a href="../administration/database_update.php" class="left_nav_link">Database Update</a></li>
					<li><a href="../administration/construction.php" class="left_nav_link">Website Settings</a></li>
					<li><a href="../administration/construction.php" class="left_nav_link">Website Themes</a></li>
					<li><a href="../administration/user_management.php" class="left_nav_link">User Management</a></li>
					
				</ul>
			</div>			
		</div>
	<div class="standard_tile_line"></div>
</div>

{/block}
{block name=java_script}
<script type="text/javascript">
$(document).ready(function() {
	
function UserSearch() {
	
	var form_values = $( "#user_search" ).serialize();
	
	$.ajax({
 
    // The URL for the request
    url: "ajax_user_management.php",
 
    // The data to send (will be converted to a query string)
    data: form_values,
 
    // Whether this is a POST or GET request
    type: "GET",
 
    // The type of data we expect back
    dataType : "html",
 
    // Code to run if the request succeeds;
    // the response is passed to the function
    success: function( html ) {
        $( "#ajax_usersearch" ).html( html );
    }
	});
}





	
	$( "#quick_search_small_select" ).change(function () { UserSearch(); });
	$( "#no_comments" ).change(function () {
		if ($(this).is(':checked')) { $("#with_comments").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_comments" ).change(function () {
		if ($(this).is(':checked')) { $("#no_comments").prop("checked", false);}
		 UserSearch();
	});
	$( "#no_submissions" ).change(function () {
		if ($(this).is(':checked')) { $("#with_submissions").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_submissions" ).change(function () {
		if ($(this).is(':checked')) { $("#no_submissions").prop("checked", false);}
		 UserSearch();
	});
	$( "#no_email" ).change(function () {
		if ($(this).is(':checked')) { $("#with_email").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_email" ).change(function () {
		if ($(this).is(':checked')) { $("#no_email").prop("checked", false);}
		UserSearch();
	});
	$( "#no_news" ).change(function () {
		if ($(this).is(':checked')) { $("#with_news").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_news" ).change(function () {
		if ($(this).is(':checked')) { $("#no_news").prop("checked", false);}
		 UserSearch();
	});
	$( "#no_links" ).change(function () {
		if ($(this).is(':checked')) { $("#with_links").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_links" ).change(function () {
		if ($(this).is(':checked')) { $("#no_links").prop("checked", false);}
		 UserSearch();
	});
	$( "#no_interviews" ).change(function () {
		if ($(this).is(':checked')) { $("#with_interviews").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_interviews" ).change(function () {
		if ($(this).is(':checked')) { $("#no_interviews").prop("checked", false);}
		 UserSearch();
	});
	$( "#no_review" ).change(function () {
		if ($(this).is(':checked')) { $("#with_review").prop("checked", false);}
		 UserSearch();
	});
	$( "#with_review" ).change(function () {
		if ($(this).is(':checked')) { $("#no_review").prop("checked", false);}
		 UserSearch();
	});
	$( "#not_admin" ).change(function () {
		if ($(this).is(':checked')) { $("#is_admin").prop("checked", false);}
		 UserSearch();
	});
	$( "#is_admin" ).change(function () {
		if ($(this).is(':checked')) { $("#not_admin").prop("checked", false);}
		 UserSearch();
	});	
		

});

$( document ).ajaxComplete(function() {
  UserlistFunction();
	UserSearch();
});

$(document).ready(function() {
	UserlistFunction();

});



function UserlistFunction() {
	
			// select all checkboxes in list
	$( '#user_select_all' ).click(function () {
		 $('.user_checkbox').prop('checked', $(this).prop('checked'));
	});
	
	
		// Are you sure question Delete
	$( "#user_list_action" ).change(function () {
		 
		 if ($(this).val() == "delete_user") {
			     $( "#dialog_confirm_delete" ).dialog({
					resizable: false,
					height:140,
					modal: true,
					buttons: {
						"Delete user(s)": function() {
						$( this ).dialog( "close" );
						UserModify();
						},
						Cancel: function() {
						$( this ).dialog( "close" );
						}			
					}
				});
		}
		 if ($(this).val() == "deactivate_user") {
			     $( "#dialog_confirm_deactivate" ).dialog({
					resizable: false,
					height:140,
					modal: true,
					buttons: {
						"Deactivate user(s)": function() {
						$( this ).dialog( "close" );
						},
						Cancel: function() {
						$( this ).dialog( "close" );
						}			
					}
				});
		}
	});


}

function UserModify() {
	
	var form_values = $( "#user_list" ).serialize();
	
	$.ajax({
 
    // The URL for the request
    url: "db_user_management.php",
 
    // The data to send (will be converted to a query string)
    data: form_values,
 
    // Whether this is a POST or GET request
    type: "POST",
 
    // The type of data we expect back
    dataType : "text",
 
    // Code to run if the request succeeds;
    // the response is passed to the function
    success: function( text ) {
        
        $.notify_osd.create({
				'text'        : text,             // notification message
				'icon'        : '../templates/0/icons/star.png', // icon path, 48x48
				'sticky'      : false,             // if true, timeout is ignored
				'timeout'     : 4,                 // disappears after 6 seconds
				'dismissable' : true               // can be dismissed manually
				});
		
		//Reload userlist
        	var form_values = $( "#user_search" ).serialize();
	
		$.ajax({
 
		// The URL for the request
		url: "ajax_user_management.php",
 
		// The data to send (will be converted to a query string)
		data: form_values,
 
		// Whether this is a POST or GET request
		type: "GET",
 
		// The type of data we expect back
		dataType : "html",
 
		// Code to run if the request succeeds;
		// the response is passed to the function
		success: function( html ) {
        $( "#ajax_usersearch" ).html( html );
		}
			});
    }
	});
}





</script>
{/block}
{block name=right_tile}

<div class="standard_tile" id="{$quick_search_games}">
	<h1>SEARCH</h1>
		<div class="standard_tile_line"></div>
			<br>
			<form action="test" method="post" name="user_search" id="user_search">
				<div class="standard_table_center">
					<h3>User search options:</h3>	<br> 			
					<div class="standard_table_center">
						By name :<br>	
						<select name="userbrowse" id="quick_search_small_select">
							<option value="-">-</option>
							{html_options values=$az_value output=$az_output selected=$az_select}
						</select>
						<input type="text" name="usersearch" value="" class="standard_tile_input_small">
					</div>
					<br>
					<br>
					<br>
					<div id="quick_search_options" class="standard_table_left">
						<div style="display:table-row;">
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_comments"  id="no_comments" value="1" class="quick_search_check">
								No Comments&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_submissions" id="no_submissions" value="1" class="quick_search_check">
								No Submissions&nbsp;
							</div>
						</div>
						<div style="display:table-row;">
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_email" id="no_email" value="1" class="quick_search_check">
								No Email
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_news" id="no_news" value="1" class="quick_search_check">
								No News posts&nbsp;
							</div>
						</div>	
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_links" id="no_links" value="1" class="quick_search_check">
								No Link submissions&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_interviews" id="no_interviews" value="1" class="quick_search_check">
								No Interviews&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="no_review" id="no_review" value="1" class="quick_search_check">
								No Review&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="not_admin" id="not_admin" value="1" class="quick_search_check">
								Not AL Administrator&nbsp;
							</div>
						</div>	
						<div style="display:table-row;">
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_comments" id="with_comments" value="1" class="quick_search_check">
								With Comments&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_submissions" id="with_submissions" value="1" class="quick_search_check">
								With Submissions&nbsp;
							</div>
						</div>		
						<div style="display:table-row;">
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_email" id="with_email" value="1" class="quick_search_check">
								With Email&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_news" id="with_news" value="1" class="quick_search_check">
								With News posts&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_links" id="with_links" value="1" class="quick_search_check">
								With Link Submissions&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_interviews" id="with_interviews" value="1" class="quick_search_check">
								With Interviews&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="with_review" id="with_review" value="1" class="quick_search_check">
								With Review&nbsp;
							</div>
						</div>
						<div style="display:table-row;">	
							<div style="display:table-cell;font-weight:bold;vertical-align:middle;"><input type="checkbox" name="is_admin" id="is_admin" value="1" class="quick_search_check">
								Is AL Administrator&nbsp;
							</div>
						</div>				
					</div>
					<br>
					<input type="hidden" name="action" id="action_ajax_search" value="users">
					<br><br>
					<hr>
				</div>
			</form>	

</div>
















{/block}

{block name=main_tile}
{block name=main_stats}	
<div id="dialog_confirm_delete" title="Delete Users?" style="display:none;">
  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
  These users will be permanently deleted. Are you sure?</p>
</div>
<div id="dialog_confirm_deactivate" title="Deactivate Users?" style="display:none;">
  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
  These users will be deactivated. Are you sure?</p>
</div>
<div class="standard_tile" id="{$main_stats}">
	<h1>USER MANAGEMENT</h1>
	<div class="standard_tile_line"></div>
	<div class="standard_tile_text">
		<form action="test" method="post" name="user_list" id="user_list">
		<div class="main_stats_container" id="ajax_usersearch">
						
						{if isset($users)}
						<table class="standard_table_list">
						<tr>
							<th><input type="checkbox" name="user_select_all" id="user_select_all" class="quick_search_check"> Select</th>
							<th>User Name</th>
							<th>Join Date</th>
							<th>Last Visit</th>
							<th>Email</th>

						</tr>
						{foreach from=$users item=line}
						<tr>
							<td class="standard_table_center"><input type="checkbox" name="user_id[]" value="{$line.user_id}" class="user_checkbox"></td>
							<td class="standard_table_center">{$line.user_name}</td>
							<td class="standard_table_center">{if $line.join_date != ''}{$line.join_date}{else}<i>n/a</i>{/if}</td>
							<td class="standard_table_center">{if $line.last_visit != ''}{$line.last_visit}{else}<i>n/a</i>{/if}</td>
							<td class="standard_table_center">{if $line.email != ''}<a href="mailto:{$line.email}" class="standard_tile_link_black">email</a>{else}<i>n/a</i>{/if}</td>
						</tr>
						{/foreach}
						{else}
						<div class="left_nav_section">No users found</div>
						{/if}	
						{if isset($nr_users)}
						<tr>
							<td class="standard_table_left" colspan="5">
								<img width="38" height="22" style="float:left;" alt="" src="../templates/0/images/arrow_ltr.gif">	
								<select name="action" id="user_list_action">					
									<option value="-" selected>Select Action</option>
									<option value="email_user">Send Email</option>
									<option value="deactivate_user">Deactivate User</option>
									<option value="delete_user">Delete User</option>
								</select>
								<b>Found {if $nr_users != ''}{$nr_users}{else}0{/if} users in {$query_time} sec</b>
							</td>
						</tr>
						{/if}
						</table>	

		</div>
		</form>
	</div>
</div>
{/block}
{/block}
