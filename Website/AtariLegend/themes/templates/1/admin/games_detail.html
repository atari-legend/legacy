{*
/***************************************************************************
*                                games_detail.html
*                            ------------------------
*   begin                : Tuesday, September 11, 2005
*   copyright            : (C) 2005 Atari Legend
*   email                : admin@atarilegend.com
*   actual update        : Creation of file
*
*   Id: games_detail.html,v 0.10 2005/10/11 15:03 Zombieman
*   Id: games_detail.html,v 0.20 2015/11/02 21:26 STG
*   Id: games_detail.html,v 0.30 2015/12/27 21:26 STG - 1920 width/HTML Valid/Messages -- NO FLEXBOX
*   Id: games_detail.html,v 0.31 2017/01/06 STG - added falcon vga and rgb option
*   id: games_detail.html,v 0.32 2017/02/26 22:19 STG - fixed 'write a review link'
*
***************************************************************************/

//****************************************************************************************
// This is the detail page of a game. Change all the specifics over here!
//****************************************************************************************
*}
{extends file='1/admin/main.html'}
{block name=left_tile}
    {if $game_screenshot <> null}
        {include file='1/admin/games_detail_editing.html'}
        <br>
    {/if}
    {include file='1/admin/games_release_list.html'}
    <br>
    <div class="standard_tile text-center" id="gd_more_data_left">
        <h1>MORE DATA</h1>
        <div class="standard_tile_line"></div>
        <div class="standard_tile_padding">
            <div class="gd_navigator">
                <a href="../games/games_facts.php?game_id={$game->getId()}" class="primary_button">Game facts <span class="help-hint">({$nr_facts})</span></a>
                <a href="../games/games_screenshot_add.php?game_id={$game->getId()}" class="primary_button">Screenshots <span class="help-hint">({$nr_screenshots})</span></a>
                <a href="../magazine/magazine_review_score.php?game_id={$game->getId()}" class="primary_button">Mag review scores <span class="help-hint">({$nr_magazines})</span></a>
                <a href="../games/games_box.php?game_id={$game->getId()}" class="primary_button">Boxscans <span class="help-hint">({$nr_boxscans})</span></a>
                <a href="../games/games_similar.php?game_id={$game->getId()}" class="primary_button">Similar Games <span class="help-hint">({$nr_similar})</span></a>
                <a href="../games/games_review.php?game_id={$game->getId()}" class="primary_button">Reviews <span class="help-hint">({$nr_reviews})</span></a>
                {if $nr_comments > 0}
                    <a href="../games/games_comment.php?game_id={$game->getId()}" class="primary_button">Moderate comments</a>
                {/if}
            </div>
            <br>
            <div class="gd_navigator">
                <a href="../../games/games_detail.php?game_id={$game->getId()}"
                    class="primary_button button_info">
                    <i class="fa fa-eye" aria-hidden="true"></i> View on main site
                </a>
            </div>
            <br>
            <div class="gd_navigator">
                <a href="../games/db_games_detail.php?game_id={$game->getId()}&amp;action=delete_game"
                    class="primary_button button_danger"
                    onclick="javascript:return confirm('The game will be deleted')">
                    <i class="fa fa-trash" aria-hidden="true"></i> Delete game
                </a>
            </div>
            <br>
        </div>
    </div>
{/block}

{block name=additional_scripts}
    <script src="{$template_dir}includes/js/ui.widgets.js"></script><!-- The autocomplete and dropdown switcher -->
    <script>
        $(document).ready(function () {
            $('select[name=individual_id]').altAutocomplete();
        });
    </script>
{/block}

{block name=right_tile}
    <div class="standard_tile text-center" id="gd_more_data_right">
        <h1>MORE DATA</h1>
        <div class="standard_tile_line"></div>
        <div class="standard_tile_padding">
            <div class="gd_navigator">
                <a href="../games/games_facts.php?game_id={$game->getId()}" class="primary_button">Game facts <span class="help-hint">({$nr_facts})</span></a>
                <a href="../games/games_screenshot_add.php?game_id={$game->getId()}" class="primary_button">Screenshots <span class="help-hint">({$nr_screenshots})</span></a>
                <a href="../magazine/magazine_review_score.php?game_id={$game->getId()}" class="primary_button">Mag review scores <span class="help-hint">({$nr_magazines})</span></a>
                <a href="../games/games_box.php?game_id={$game->getId()}" class="primary_button">Boxscans <span class="help-hint">({$nr_boxscans})</span></a>
                <a href="../games/games_similar.php?game_id={$game->getId()}" class="primary_button">Similar Games <span class="help-hint">({$nr_similar})</span></a>
                <a href="../games/games_review.php?game_id={$game->getId()}" class="primary_button">Reviews <span class="help-hint">({$nr_reviews})</span></a>
                {if $nr_comments > 0}
                    <a href="../games/games_comment.php?game_id={$game->getId()}" class="primary_button">Moderate comments</a>
                {/if}
            </div>
            <br>
            <div class="gd_navigator">
                <a href="../../games/games_detail.php?game_id={$game->getId()}"
                    class="primary_button button_info">
                    <i class="fa fa-eye" aria-hidden="true"></i> View on main site
                </a>
            </div>
            <br>
            <div class="gd_navigator">
                <a href="../games/db_games_detail.php?game_id={$game->getId()}&amp;action=delete_game"
                    class="primary_button button_danger"
                    onclick="javascript:return confirm('The game will be deleted')">
                    <i class="fa fa-trash" aria-hidden="true"></i> Delete game
                </a>
            </div>
            <br>
        </div>
    </div>
    <br>
    {include file='1/admin/quick_search_games.html'}
    <br>
    {include file='1/main/tile_bug_report.html'}
{/block}
{block name=java_script}
<script>

function browseDeveloper(str) {
    if (str == "") {
        $('#ajax_developer_browse').html('');
    } else {
        $.ajaxQueue({
            // The URL for the request
            url: '../games/ajax_games_detail.php',
            data: 'action=company_developer_browse&query='+str,
            type: 'GET',
            dataType: 'html',
            // Code to run if the request succeeds;
            success: function (html) {
                $('#ajax_developer_browse').html(html);
            }
        });
    }
}

$('#input-tags3').selectize({
    plugins: ['remove_button'],
    delimiter: ',',
    persist: false,
    create: function(input) {
        return {
            value: input,
            text: input
        }
    }
});

</script>
{/block}

{block name=main_tile}
<div class="standard_tile" id="games_detail">
    {if isset ($game_info)}
        <h1>{$game_info.game_name|UPPER}</h1>
        <div class="standard_tile_line"></div>
        <div class="standard_tile_padding">
            <fieldset class="secondary_fieldset">
                <legend class="primary_legend">Basic game info</legend>

                <div class="help-hint">
                    Overhere you can add additional game info. If you want to see the details of a release, use the links on the left. To delete a complete game and all its releases, press the delete button on the right.
                </div>
                <br>
                <form action="../games/db_games_detail.php" method="post" name="edit">
                    <input type="hidden" name="game_id" value="{$game->getId()}">
                    <input type="hidden" name="action" value="modify_game">
                    <div>
                        <div class="gd_basic_game_info_container">
                            <div id="gd_basic_game_info_1">
                                <b>Game name</b>
                                <br>
                                <input type="text" maxlength="255" name="game_name" value="{$game_info.game_name}" class="standard_input input_large">
                                <br>
                                <br>
                                <b>Game information</b>
                                <br>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="unreleased" name="unreleased" value="1" {if $game_info.game_unreleased == 1} checked{/if}>
                                            <label for="unreleased"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">Unreleased&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="development" name="development" value="1" {if $game_info.game_development == 1} checked{/if}>
                                            <label for="development"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">In development&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="unfinished" name="unfinished" value="1" {if $game_info.game_unfinished == 1} checked{/if}>
                                            <label for="unfinished"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">Unfinished&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="wanted" name="wanted" value="1" {if $game_info.game_wanted <> ''} checked{/if}>
                                            <label for="wanted"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">Wanted&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="arcade" name="arcade" value="1" {if $game_info.game_arcade == 1} checked{/if}>
                                            <label for="arcade"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">Arcade conversion&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="seuck" name="seuck" value="1" {if $game_info.game_seuck == 1} checked{/if}>
                                            <label for="seuck"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">SEUCK game&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="stos" name="stos" value="1" {if $game_info.game_stos == 1} checked{/if}>
                                            <label for="stos"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">STOS game&nbsp;</div>
                                </div>
                                <div class="gd_basic_game_info_row">
                                    <div class="gd_basic_game_info_row_check">
                                        <div class="links_mod_checkbox">
                                            <input type="checkbox" id="stac" name="stac" value="1" {if $game_info.game_stac == 1} checked{/if}>
                                            <label for="stac"></label>
                                        </div>
                                    </div>
                                    <div class="gd_basic_game_info_row_checktxt">STAC game&nbsp;</div>
                                </div>
                            </div>
                            <div id="gd_basic_game_info_2">
                                <b>Categories</b>&nbsp;&nbsp;
                                <div class="control-group">
                                    <label for="input-tags"></label>
                                    <select name="category[]" multiple id="input-tags" class="standard_select input_full">
                                    {foreach from=$cat item=line}
                                        <option value="{$line.cat_id}" {$line.cat_selected}>{$line.cat_name}</option>
                                    {/foreach}
                                    </select>
                                </div>
                                <br>
                                <span class="help-hint">Click to choose and add categories</span>
                                <script>
                                    $('#input-tags').selectize({
                                        plugins: ['remove_button'],
                                        persist: false,
                                        create: true,
                                        render: {
                                            item: function(data, escape) {
                                                return '<div class="primary_button" style="border-radius:3px;">' + escape(data.text) + '</div>';
                                            }
                                        },
                                    });
                                </script>
                            </div>
                        </div>
                        <br>
                        <div class="gd_clear">
                            <input type="submit" name="valider" value="Save changes" class="secondary_button">
                        </div>
                </form>
            </fieldset>
            <br>

            <fieldset class="secondary_fieldset">
                <legend class="primary_legend">Development info</legend>
                <div class="help-hint">
                    You can add as many developers/creators as you like to a game. Use the dropdown to add a role to the person or team.
                </div>
            <br>

                <a id="gd_authors"><b>Authors &amp; Creators</b></a>
                <br>

                {if isset($game_author)}
                    {foreach from=$game_author item=author}
                        <form action="db_games_authors.php" method="post">

                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="game_id" value="{$game->getId()}">
                            <input type="hidden" name="individual_id" value="{$author.ind_id}">
                            <input type="hidden" name="author_type_id" value="{$author.author_type_id}">

                            <a title="Remove {$author.ind_name|escape:"html"} from this game"
                                href="db_games_authors.php?game_id={$game->getId()}&amp;individual_id={$author.ind_id}&amp;author_type_id={$author.author_type_id}&amp;action=remove"
                                onclick="javascript:return confirm('This author will be removed from the game')">
                                <span class="fa fa-fw fa-trash"></span>
                            </a>

                            <input type="text" value="{$author.ind_name}" class="standard_input input_large" disabled id="gd_game_author">
                            <a href="../individuals/individuals_edit.php?ind_id={$author.ind_id}" title="Edit individual" class="standard_tile_link"><i class="fa fa-fw fa-pencil edit_author" aria-hidden="true"></i></a>

                            <select name="new_author_type_id"
                                onchange="jQuery('#update-author-{$author.game_author_id}').show()"
                                class="standard_select select_medium">
                                <option value="">-</option>
                                {foreach from=$author_types item=author_type}
                                    <option value="{$author_type.author_type_id}" {if $author_type.author_type eq $author.author_type_info} selected{/if}>{$author_type.author_type}</option>
                                {/foreach}
                            </select>
                            <input type="submit" id="update-author-{$author.game_author_id}" style="display: none;" class="secondary_button" value="Update">

                        </form>
                    {/foreach}
                {/if}

                <hr class="separator_add">

                <form action="db_games_authors.php" method="post">
                    <input type="hidden" name="action" value="add">
                    <input type="hidden" name="game_id" value="{$game->getId()}">

                    <a href="javascript:;"
                        class="left_nav_link"
                        id="individual_select_toggle"
                        title="Click for dropdown mode">
                        <i class="fa fa-fw fa-chevron-circle-down" aria-hidden="true"></i>
                    </a>

                    <select name="individual_id"
                        class="standard_select select_large" id="gd_game_author_select"
                        data-alt-autocomplete-endpoint="../common/autocomplete.php?extraParams=individual"
                        data-alt-autocomplete-toggle="#individual_select_toggle"
                        data-alt-autocomplete-placeholder="Start typing a name…"
                        required>
                        <option value="" selected="selected" disabled></option>
                        {foreach from=$individuals item=individual}
                            <option value="{$individual->getId()}">{$individual->getName()}</option>
                        {/foreach}
                    </select>
                    <span class="fa fa-fw edit_author"></span>

                    <select name="author_type_id" class="standard_select select_medium">
                        <option value="" selected="selected">-</option>
                        {foreach from=$author_types item=author_type}
                            <option value="{$author_type.author_type_id}">{$author_type.author_type}</option>
                        {/foreach}
                    </select>

                    <button type="submit" class="secondary_button">Add author</button>
                </form>

                <br>
                <br>

                <a id="gd_developers"><b>Developers</b></a>
                <br>

                {if isset($developers)}
                    {foreach from=$developers item=developer}
                        <form action="db_games_developer.php" method="get">
                            <a title="Remove {$developer.pub_dev_name|escape:"html"} from this game"
                                href="db_games_developer.php?game_id={$game->getId()}&amp;pub_dev_id={$developer.pub_dev_id}&amp;developer_role_id={$developer.developer_role_id}&amp;action=remove"
                                onclick="javascript:return confirm('This developer will be removed from the game')">
                                <span class="fa fa-fw fa-trash"></span>
                            </a>

                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="game_id" value="{$game->getId()}">
                            <input type="hidden" name="pub_dev_id" value="{$developer.pub_dev_id}">
                            <input type="hidden" name="developer_role_id" value="{$developer.developer_role_id}">

                            <input type="text" value="{$developer.pub_dev_name}" class="standard_input input_large" disabled id="gd_game_dev">
                            <a href="../company/company_edit.php?comp_id={$developer.pub_dev_id}" title="Edit developer" class="standard_tile_link"><i class="fa fa-fw fa-pencil edit_author" aria-hidden="true"></i></a>

                            <select name="new_developer_role_id"
                                onchange="jQuery('#update-developer-{$developer.pub_dev_id}').show()"
                                class="standard_select select_medium">
                                <option value="">-</option>
                                {foreach from=$developer_role item=info}
                                    <option value="{$info.developer_role_id}" {if $developer.developer_role_id eq $info.developer_role_id} selected{/if}>{$info.developer_role}</option>
                                {/foreach}
                            </select>
                            <input type="submit" id="update-developer-{$developer.pub_dev_id}" style="display: none;" class="secondary_button" value="Update">

                        </form>
                    {/foreach}
                {/if}

                <hr class="separator_add">

                <form action="../games/db_games_developer.php" method="post">
                    <input type="hidden" name="game_id" value="{$game_id}">
                    <input type="hidden" name="action" value="add">

                    <span class="fa fa-fw"></span>

                    <select name="developerbrowse" onchange="browseDeveloper(this.value)" class="standard_select select_small" id="gd_dev_browse">
                        <option value="" SELECTED>-</option>
                        {html_options values=$az_value output=$az_output}
                    </select>
                    <span id="ajax_developer_browse">
                        <select id="gd_dev_name" name="pub_dev_id" class="standard_select" required>
                            <option value="" selected="selected" disabled>0-9 &hellip;</option>
                            {foreach from=$pubdevs item=pubdev}
                                <option value="{$pubdev->getId()}">{$pubdev->getName()}</option>
                            {/foreach}
                        </select>
                    </span>
                    <span class="fa fa-fw edit_author"></span>

                    <select name="developer_role_id" class="standard_select select_medium">
                        <option value="" selected="selected">-</option>
                        {foreach from=$developer_role item=line}
                            <option value="{$line.developer_role_id}">{$line.developer_role}</option>
                        {/foreach}
                    </select>

                    <input type="submit" value="Add developer" class="secondary_button">
                </form>
                <br>
            </fieldset>

            <br>

            <div>
                <div id="gd_game_aka">


                        <fieldset class="secondary_fieldset">
                        <legend class="primary_legend">Add game AKA</legend>

                        <div class="help-hint">
                            If the game is known by other names that are not considered a seperate release, enter the title(s) here. Use the dropdown to add the language of the AKA title (optional).
                        </div>
                        <br>
                        {if $nr_aka <> 0}
                            {foreach from=$aka item=line}
                            <form action="../games/db_games_detail.php" method="post" name="aka" id="aka">
                                <input type="hidden" name="action" value="update_aka">
                                <input type="hidden" name="game_id" value="{$line.game_id}">
                                <input type="hidden" name="game_aka_id" value="{$line.game_aka_id}">
                                <a href="../games/db_games_detail.php?game_aka_id={$line.game_aka_id}&action=delete_aka&game_id={$line.game_id}"
                                    class="left_nav_link"
                                    onclick="javascript:return confirm('This AKA will be removed from the game')">
                                    <span class="fa fa-fw fa-trash"></span>
                                </a>
                                <input type="text" value="{$line.game_aka_name}" class="standard_input input_large" disabled id="gd_aka">

                                <select name="new_language_id"
                                    onchange="jQuery('#update-aka-{$line.game_aka_id}').show()"
                                    class="standard_select select_medium">
                                    <option value="">-</option>
                                    {foreach from=$languages item=language}
                                        <option value="{$language.id}" {if $line.language_id eq $language.id} selected{/if}>{$language.name}</option>
                                    {/foreach}
                                </select>
                                <input type="submit" id="update-aka-{$line.game_aka_id}" style="display: none;" class="secondary_button" value="Update">
                                <br>
                            </form>
                            {/foreach}
                        {/if}
                        <hr class="separator_add">
                        <form action="../games/db_games_detail.php" method="post" name="aka" id="aka">
                            <input type="hidden" name="action" value="game_aka">
                            <input type="hidden" name="game_id" value="{$game_id}">
                            <span class="fa fa-fw"></span>
                            <input type="text" name="game_aka" class="standard_input input_large" placeholder="Enter new AKA" required id="gd_aka_input">
                            <select name="language_id" class="standard_select select_medium">
                                <option value="">-</option>
                                {foreach from=$languages item=language}
                                    <option value="{$language.id}">{$language.name}</option>
                                {/foreach}
                            </select>
                            <input type="submit" name="valider" value="Add AKA" class="secondary_button">
                        </form>
                    </fieldset>
                </div>
                <br>

                {if isset($publishers)}
                    <div id="gd_publisher_info">
                        <fieldset class="secondary_fieldset">
                            <legend class="primary_legend">Publisher info</legend>

                            <div class="help-hint">
                                <span class="fa fa-warning"></span> No new publishers can be added. Publisher should be associated to releases
                                rather than directly to games. Use the releases menu on the left to navigate releases.
                                This section is kept to allow manual merging of publishers into releases, and will be removed
                                when this merging is complete.
                            </div>
                            <br>

                            {foreach from=$publishers item=publisher}
                                <form action="db_games_publisher.php" method="get">
                                    <a title="Remove {$publisher.pub_dev_name|escape:"html"} from this game"
                                        href="db_games_publisher.php?game_id={$game->getId()}&amp;pub_dev_id={$publisher.pub_dev_id}&amp;continent_id={$publisher.continent_id}&amp;game_extra_info_id={$publisher.game_extra_info_id}&amp;action=remove"
                                        onclick="javascript:return confirm('This publisher will be removed from the game')">
                                        <span class="fa fa-fw fa-trash"></span>
                                    </a>

                                    <input type="hidden" name="action" value="update">
                                    <input type="hidden" name="game_id" value="{$game->getId()}">
                                    <input type="hidden" name="pub_dev_id" value="{$publisher.pub_dev_id}">
                                    <input type="hidden" name="continent_id" value="{$publisher.continent_id}">
                                    <input type="hidden" name="game_extra_info_id" value="{$publisher.game_extra_info_id}">

                                    <input type="text" value="{$publisher.pub_dev_name}" class="standard_input input_large" disabled>

                                    <select name="new_continent_id" disabled
                                        class="standard_select select_medium">
                                        <option value="">-</option>
                                        {foreach from=$continents item=continent}
                                            <option value="{$continent.continent_id}" {if $publisher.continent_id eq $continent.continent_id} selected{/if}>{$continent.continent_name}</option>
                                        {/foreach}
                                    </select>

                                    <select name="new_game_extra_info_id" disabled
                                        class="standard_select select_medium">
                                        <option value="">-</option>
                                        {foreach from=$developer_role item=role}
                                            <option value="{$role.developer_role_id}" {if $publisher.game_extra_info_id eq $role.developer_role_id} selected{/if}>{$role.developer_role}</option>
                                        {/foreach}
                                    </select>

                                    &nbsp; Assign to release:
                                    <a href="games_release_detail.php?game_id={$game->getId()}&amp;pub_dev_id={$publisher.pub_dev_id}&amp;continent_id={$publisher.continent_id}{if $publisher.game_extra_info_id == 1}&amp;type=Budget{/if}">[new release]</a>
                                    {foreach from=$game_releases item=release}
                                        {if $release->getPublisher() == null}
                                            <a href="db_games_publisher.php?action=associate_to_release&amp;game_release_id={$release->getId()}&amp;game_id={$game->getId()}&amp;pub_dev_id={$publisher.pub_dev_id}&amp;continent_id={$publisher.continent_id}&amp;game_extra_info_id={$publisher.game_extra_info_id}"
                                                onclick="javascript:return confirm('{$publisher.pub_dev_name|escape:"quotes"} will be associated to the {$release->getDate()|date_format:"Y"} release, along with the continent and type, then removed from the game')">
                                                {$release->getDate()|date_format:"Y"}</a>
                                        {/if}
                                    {/foreach}

                                </form>
                            {/foreach}
                        </fieldset>
                    </div>
                {/if}
            </div>
            <div id="gd_bottom">
                <div id="gd_back">
                    <div class="standard_tile_text_center"><a href="javascript:history.go(-1)" class="standard_tile_link">back</a></div>
                </div>
            </div>
        </div>
    {else}
        <div class="standard_tile_line"></div>
        <div class="standard_tile_padding">
            <div class="left_nav_section">
                Game not available
            </div>
        </div>
        <div id="gd_bottom">
            <div id="gd_back">
                <div class="standard_tile_text_center"><a href="javascript:history.go(-1)" class="standard_tile_link">back</a></div>
            </div>
        </div>
    {/if}
</div>
{/block}
