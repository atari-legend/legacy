{*
/***************************************************************************
 *                                games_comment_main.php
 *                            ------------------------------
 *   begin                : Friday July 14, 2017
 *   copyright            : (C) 2017 Atari Legend
 *   email                : martens_maarten@hotmail.com_addref
 *   actual update        : file creation
 *
 *   Id: games_comment_main.php,v 0.10 2017/07/14 ST Graveyard
 *
 ***************************************************************************/

//****************************************************************************************
// This is the main games comments page
//****************************************************************************************
*}

{extends file='1/main/main.html'}
{block name=title}Latest Atari ST game comments | Atari Legend{/block}

{block name=main_body}

    {literal}
    <script type="text/javascript">
    function CommentEditable(comment_id,user_id) {
        var string = "comment_edit";
        var editable_comment = string.concat(comment_id);

        var string = "comment_edit_icon";
        var edit_icon = string.concat(comment_id);

        var string = "comment_save_icon";
        var save_icon = string.concat(comment_id);

        var string = "comment_input";
        var comment_input = string.concat(comment_id);

        var input = document.getElementById(comment_input);
        input.style.display='inline';

        var save = document.getElementById(save_icon);
        save.style.display='inline';

        var edit = document.getElementById(edit_icon);
        edit.style.display='none';

        var output = document.getElementById(editable_comment);
        output.style.display='none';
    }

    function SaveEditable(comment_id,user_id,view,c_counter,v_counter) {

        //It took me ages to get his to work because I'm a dipshit - I hate ajax --> ST Graveyard 14/07/2014 @fucking 00:44
        //Im not using contenteditable crap on a div because this way, loads of <br> statements are added in the database.
        //So I'm changing the div to a text area, still, in java it seems a return is not sent to the server so I'm doing a conversion to <br>
        //Once the <br> are in the db, I do another conversion when I load the from the database into an input field

        var string = "comment_input";
        var comment_data = string.concat(comment_id);

        var comment = document.getElementById(comment_data).value
        comment = comment.replace(/\n\r?/g, '<br />');

        var url = "../games/db_games_comment_main.php?action=save_comment&view="+view+"&comment_id="+comment_id+"&users_id="+user_id+"&c_counter="+c_counter+"&v_counter="+v_counter+"&data="+comment;

        if (comment_id == "")
        {
            document.getElementById("main_comments_all").innerHTML = "";
            return;
        }
        else
        {
            if (window.XMLHttpRequest)
            {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            }
            else
            {
                // code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                {
                    document.getElementById("main_comments_all").innerHTML = xmlhttp.responseText;
                }
            }
            xmlhttp.open("GET",url,true);
            xmlhttp.send();
        }
    }

    function DeleteEditable(comment_id,user_id,view,c_counter,v_counter) {

         // CONFIRM REQUIRES ONE ARGUMENT
         var message = "Are you sure you want to delete this comment?";
         // CONFIRM IS BOOLEAN. THAT MEANS THAT
         // IT RETURNS TRUE IF 'OK' IS CLICKED
         // OTHERWISE IT RETURN FALSE
         var return_value = confirm(message);

         if (return_value !="0")
         {
             if (comment_id == "")
                {
                    document.getElementById("main_comments_all").innerHTML = "";
                    return;
                }
                else
                {
                    if (window.XMLHttpRequest)
                    {
                        // code for IE7+, Firefox, Chrome, Opera, Safari
                        xmlhttp = new XMLHttpRequest();
                    }
                    else
                    {
                        // code for IE6, IE5
                        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }
                    xmlhttp.onreadystatechange = function()
                    {
                        if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                        {
                            document.getElementById("main_comments_all").innerHTML = xmlhttp.responseText;
                        }
                    }
                    xmlhttp.open("GET","../games/db_games_comment_main.php?action=delete_comment&view="+view+"&users_id="+user_id+"&c_counter="+c_counter+"&v_counter="+v_counter+"&comment_id="+comment_id,true);
                    xmlhttp.send();
                }
            }
         }
    </script>
    {/literal}

    <link rel="stylesheet" href="{$style_dir}css/vendor/font-awesome-4.7.0/css/font-awesome.min.css"> <!-- Font awesome for icons-->

    <div id="main" class="main_container_cpanel">
        <div class="content_box_cpanel" id="column_left_cpanel">
            <br>
            {block name=left_tile}
                {include file='1/main/statistics_tile.html'}
                <br>
                {include file='1/main/who_is_it_tile.html'}
            {/block}
        </div>
        <div class="content_box_cpanel" id="column_center_cpanel">
            <br>
            <div class="standard_tile" id="games_main">
                <div class="help-tip">
                    <p>
                        <u>Only available with your own comments:</u><br>
                        <i class="fa fa-pencil" aria-hidden="true"></i> - Edit comment<br>
                        <i class="fa fa-floppy-o" aria-hidden="true"></i> - Save changes to comment<br>
                        <i class="fa fa-trash-o" aria-hidden="true"></i> - Delete comment (if )<br><br>
                        <u>General options:</u><br>
                        <i class="fa fa-envelope" aria-hidden="true"></i> - Email author of comment<br>
                        <i class="fa fa-facebook-square" aria-hidden="true"></i> - Go to Facebook profile of author<br>
                        <i class="fa fa-twitter" aria-hidden="true"></i> - Go to Twitter profile of author<br>
                        <i class="fa fa-gamepad" aria-hidden="true"></i> - Go to Atari-Forum profle<br>
                        <i class="fa fa-globe" aria-hidden="true"></i> - Visit user's website
                    </p>
                </div>
                <h1>GAME COMMENTS</h1>
                <div class="standard_tile_line"></div>
                <div class="standard_tile_text">
                    <h6 style="text-align:center;">
                        There is currently a total of <span style="font-weight:bold;">{$total_nr_comments}</span> comments in the AL database!
                    </h6>
                </div>
                <div class="standard_tile_line"></div>
                <div class="standard_list_entry">
                    <div id="main_comments_all">
                        <table class="standard_table_list_comments_main">
                        {foreach from=$comments item=line}
                            <tr>
                                <td class="gc_left_head">
                                     <h6 style="text-align:left;margin-left:5px;margin-top:3px;margin-bottom:3px;">Random shot</h6>
                                </td>
                                <td class="gc_center_head" >
                                    <h6 style="text-align:left;margin-left:5px;margin-top:3px;margin-bottom:3px;"><a href="../games/games_detail.php?game_id={$line.game_id}" class="latest_comments_link">{$line.game}</a></h6>
                                </td>
                                <td class="gc_right_head">
                                    <h6 style="text-align:right;margin-right:5px;margin-top:3px;margin-bottom:3px;">
                                    {if isset($user_session)}
                                        {if $user_session.user_id == $line.users_id}
                                            <a style="cursor: pointer;" onClick="CommentEditable({$line.comment_id},{$line.users_id})" class="latest_comments_link"><i class="fa fa-pencil" id="comment_edit_icon{$line.comment_id}" aria-hidden="true"  title="Click to edit comment"></i></a>
                                            <a style="cursor: pointer;" onClick="SaveEditable({$line.comment_id},{$line.users_id},'{$links.view}','{$links.c_counter}','{$links.v_counter}')" class="latest_comments_link"><i class="fa fa-floppy-o" id="comment_save_icon{$line.comment_id}" aria-hidden="true" title="Click to save change" style="display:none;"></i></a>
                                            <a style="cursor: pointer;" onClick="DeleteEditable({$line.comment_id},{$line.users_id},'{$links.view}','{$links.c_counter}','{$links.v_counter}')" class="latest_comments_link"><i class="fa fa-trash-o" id="comment_delete_icon{$line.comment_id}" aria-hidden="true" title="Click to delete comment"></i></a>
                                        {/if}
                                        {if $line.email != ''}
                                            <a href="mailto:{$line.email}?subject=Comment%20of%20{$line.game|escape:'url'}%20at%20Atari%20Legend" class="latest_comments_link" title="Click to email user"><i class="fa fa-envelope" aria-hidden="true"></i></a>
                                        {/if}
                                        {if $line.user_fb != ''}
                                            <a href="{$line.user_fb}" class="latest_comments_link" title="Click to visit Facebook profile"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
                                        {/if}
                                        {if $line.user_twitter != ''}
                                            <a href="{$line.user_twitter}" class="latest_comments_link" title="Click to visit Twitter profile"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                                        {/if}
                                        {if $line.user_af != ''}
                                            <a href="{$line.user_af}" class="latest_comments_link" title="Click to visit Atari-Forum profile"><i class="fa fa-gamepad" aria-hidden="true"></i></a>
                                        {/if}
                                        {if $line.user_website != ''}
                                            <a href="{$line.user_website}" class="latest_comments_link" title="Click to visit users website"><i class="fa fa-globe" aria-hidden="true"></i></a>
                                        {/if}
                                    {/if}
                                    <a href="#top" class="latest_comments_link"><i class="fa fa-arrow-up" aria-hidden="true" title="Go to the top"></i></a>
                                    </h6>
                                </td>
                            </tr>
                            <tr>
                                <td class="gc_left">
                                    {if isset($line.image) and $line.image != ''}
                                        <a href="../games/games_detail.php?game_id={$line.game_id}" class="links_addnew_link">
                                        <img src="../../includes/show_image.php?file={$line.image}&amp;resize=160,null,null,null" alt="{$line.game}" class="user_stats_img_dark" style="max-width:95%;">
                                        </a>
                                    {/if}
                                    <br>
                                    <span class="standard_tile_subtext" style="margin-left:5px;">
                                        Joined: {$line.user_joindate}
                                    </span>
                                        <br>
                                    <span class="standard_tile_subtext" style="margin-left:5px;">
                                        Comments: <a href="../games/games_comment_main.php?c_counter={$links.v_counter}&amp;users_id={$line.users_id}&amp;view=users_comments"><span style="font-weight:bold;">{$line.user_comment_nr}</span></a>
                                        <br><br>
                                    </span>
                                </td>
                                <td class="gc_center" colspan="2">
                                    <div class="latest_comments_text">
                                        Posted by <a href="../../admin/user/user_detail.php?user_id_selected={$line.users_id}" class="latest_comments_link">{$line.user_name}</a> on {$line.date}
                                        <br>
                                        <br>
                                        <div id="comment_edit{$line.comment_id}"><div id="games_detail_review_main_text">{$line.comment}</div></div>
                                        <div style="width:108%;"><textarea cols="105" id="comment_input{$line.comment_id}" class="main_comments_textarea" style="display:none;">{$line.comment_edit}</textarea></div>
                                    </div>
                                </td>
                            </tr>
                        {/foreach}
                        </table>
                    </div>
                </div>
                <div class="standard_table_center">
                    {if $links.linkback != ''}
                        <a href ="../games/games_comment_main.php{$links.linkback}" class="standard_tile_link" style="float:left;margin-left:5px;margin-top:10px;">Previous page</a>
                    {/if}
                    {if $links.linknext != ''}
                        <a href="../games/games_comment_main.php{$links.linknext}" class="standard_tile_link" style="float:right;margin-right:5px;margin-top:10px;">Next page</a>
                    {/if}
                </div>
            </div>
            <br>
            <br>
            <div class="standard_table_center">
                <div class="standard_table_center"><a href="javascript:history.go(-1)" class="standard_tile_link">back</a></div>
            </div>
            <br>
        </div>
        <div class="content_box_cpanel" id="column_right_cpanel">
            <br>
            {block name=right_tile}
                {include file='1/main/tile_screenstar.html'}
                <br>
                {include file='1/main/tile_changes_per_month.html'}
            {/block}
        </div>
    </div>
{/block}
