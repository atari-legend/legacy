{*
/***************************************************************************
*                               latest_comments_tile.html
*                            -------------------------------
*   begin                : Tuesday, June 22, 2017
*   copyright            : (C) 2017 Atari Legend
*   email                : martens_maarten@hotmail.com
*   actual update        : Creation of file
*
*   Id: latest_comments_tile.html,v 0.1 2017/06/22 19:54 ST Graveyard
*
***************************************************************************/

//****************************************************************************************
// This is the 'Latest Comments' tile
//****************************************************************************************
*}

{literal}
<script type="text/javascript">
function CommentEditable(comment_id,user_id) {
    var string = "latest_comment_edit";
    var editable_comment = string.concat(comment_id);

    var string = "comment_edit_icon";
    var edit_icon = string.concat(comment_id);

    var string = "comment_save_icon";
    var save_icon = string.concat(comment_id);

    var string = "comment_input";
    var comment_input = string.concat(comment_id);

    var input = document.getElementById(comment_input);
    input.style.display='inline';

    var save = document.getElementById(save_icon);
    save.style.display='inline';

    var edit = document.getElementById(edit_icon);
    edit.style.display='none';

    var output = document.getElementById(editable_comment);
    output.style.display='none';
}

function SaveEditable(comment_id,user_id,type) {

    //It took me ages to get his to work because I'm a dipshit - I hate ajax --> ST Graveyard 14/07/2014 @fucking 00:44
    //Im not using contenteditable crap on a div because this way, loads of <br> statements are added in the database.
    //So I'm changing the div to a text area, still, in java it seems a return is not sent to the server so I'm doing a conversion to <br>
    //Once the <br> are in the database, I do another conversion when I load the from the database into an input field

    var string = "comment_input";
    var comment_data = string.concat(comment_id);

    var comment = document.getElementById(comment_data).value
    comment = comment.replace(/\n\r?/g, '<br />');

    var url = "../../common/tiles/db_latest_comments_tile.php?action=save_comment&comment_id="+comment_id+"&type="+type+"&data="+comment;

    if (comment_id == "")
    {
        document.getElementById("latest_comments_all").innerHTML = "";
        return;
    }
    else
    {
        if (window.XMLHttpRequest)
        {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        }
        else
        {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function()
        {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
            {
                document.getElementById("latest_comments_all").innerHTML = xmlhttp.responseText;
            }
        }
        xmlhttp.open("GET",url,true);
        xmlhttp.send();
    }
}

function DeleteEditable(comment_id,user_id,type) {

    // CONFIRM REQUIRES ONE ARGUMENT
    var message = "Are you sure you want to delete this comment?";
    // CONFIRM IS BOOLEAN. THAT MEANS THAT
    // IT RETURNS TRUE IF 'OK' IS CLICKED
    // OTHERWISE IT RETURN FALSE
    var return_value = confirm(message);

    if (return_value !="0")
    {
        if (comment_id == "")
            {
                document.getElementById("latest_comments_all").innerHTML = "";
                return;
            }
            else
            {
                if (window.XMLHttpRequest)
                {
                    // code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                }
                else
                {
                    // code for IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                xmlhttp.onreadystatechange = function()
                {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                    {
                        document.getElementById("latest_comments_all").innerHTML = xmlhttp.responseText;
                    }
                }
                xmlhttp.open("GET","../../common/tiles/db_latest_comments_tile.php?action=delete_comment&type="+type+"&comment_id="+comment_id,true);
                xmlhttp.send();
            }
        }
    }
</script>
{/literal}

{block name=latest_comments_tile}

{if isset($smarty_action) and $smarty_action == "delete_comment"}
    {if isset($comments)}
        <div class="games_main_detail_comments_container">
            <table class="standard_table_list_comments">
            {foreach from=$comments item=line}
                <tr>
                    <td class="standard_table_left">
                        <span class="standard_tile_subtext" style="font-weight:bold;float:left;margin-left:5px;margin-right:5px;margin-top:15px;">
                            <a href="../../admin/user/user_detail.php?user_id_selected={$line.user_id}">{$line.user_name}</a>
                        </span>
                        <span class="standard_tile_subtext" style="font-weight:bold;float:right;display:inline;margin-left:5px;margin-right:5px;margin-top:15px;">
                            <a href="../games/games_detail.php?game_id={$line.game_id}">{$line.game}</a>
                        </span>
                        <div class="latest_comments_text">
                            <div id="latest_comment_edit{$line.comment_id}"><div id="games_detail_review_main_text">{$line.comment}</div></div>
                            <div style="width:108%;"><textarea cols="70" id="comment_input{$line.comment_id}" class="latest_comments_textarea" style="display:none;">{$line.comment_edit}</textarea></div>
                        </div>
                        {if isset($user_session)}
                            <span style="font-weight:bold;float:left;margin-left:5px;margin-bottom:15px;">
                            {if $user_session.user_id == $line.user_id}
                                <a style="cursor: pointer;" onClick="CommentEditable({$line.comment_id},{$line.user_id})" class="latest_comments_link"><i class="fa fa-pencil" id="comment_edit_icon{$line.comment_id}" aria-hidden="true"  title="Click to edit comment"></i></a>
                                <a style="cursor: pointer;" onClick="SaveEditable({$line.comment_id},{$line.user_id},{if (isset($type))}'user'{else}'normal'{/if})" class="latest_comments_link"><i class="fa fa-floppy-o" id="comment_save_icon{$line.comment_id}" aria-hidden="true" title="Click to save change" style="display:none;"></i></a>
                                <a style="cursor: pointer;" onClick="DeleteEditable({$line.comment_id},{$line.user_id},{if (isset($type))}'user'{else}'normal'{/if})" class="latest_comments_link"><i class="fa fa-trash-o" id="comment_delete_icon{$line.comment_id}" aria-hidden="true" title="Click to delete comment"></i></a>
                            {/if}
                            {if $line.email != ''}
                                <a href="mailto:{$line.email}?subject=Comment%20of%20{$line.game|escape:'url'}%20at%20Atari%20Legend" class="latest_comments_link" title="Click to contact user"><i class="fa fa-envelope" aria-hidden="true"></i></a>
                            {/if}
                            {if $line.user_fb != ''}
                                <a href="{$line.user_fb}" class="latest_comments_link" title="Click to visit Facebook profile"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
                            {/if}
                            {if $line.user_twitter != ''}
                                <a href="{$line.user_twitter}" class="latest_comments_link" title="Click to visit Twitter profile"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                            {/if}
                            {if $line.user_af != ''}
                                <a href="{$line.user_af}" class="latest_comments_link" title="Click to visit Atari-Forum profile"><i class="fa fa-gamepad" aria-hidden="true"></i></a>
                            {/if}
                            {if $line.user_website != ''}
                                <a href="{$line.user_website}" class="latest_comments_link" title="Click to visit users website"><i class="fa fa-globe" aria-hidden="true"></i></a>
                            {/if}
                            </span>
                        {/if}
                        <span class="standard_tile_subtext" style="font-weight:bold;float:right;display:inline;margin-right:5px;margin-bottom:15px;">
                            {$line.date}
                        </span>
                        <br><br>
                    </td>
                </tr>
            {/foreach}
            </table>
        </div>
    {/if}
{else}
    <div class="standard_tile">
        <div class="help-tip">
            <p>
                <u>Only available with your own comments:</u><br>
                <i class="fa fa-pencil" aria-hidden="true"></i> - Edit comment<br>
                <i class="fa fa-floppy-o" aria-hidden="true"></i> - Save changes to comment<br>
                <i class="fa fa-trash-o" aria-hidden="true"></i> - Delete comment (if )<br><br>
                <u>General options:</u><br>
                <i class="fa fa-envelope" aria-hidden="true"></i> - Email author of comment<br>
                <i class="fa fa-facebook-square" aria-hidden="true"></i> - Go to Facebook profile of author<br>
                <i class="fa fa-twitter" aria-hidden="true"></i> - Go to Twitter profile of author<br>
                <i class="fa fa-gamepad" aria-hidden="true"></i> - Go to Atari-Forum profle<br>
                <i class="fa fa-globe" aria-hidden="true"></i> - Visit user's website
            </p>
        </div>
        <h1><a href="../games/games_comment_main.php" class="standard_tile_link" title="Click to see all comments">LATEST COMMENTS</a></h1>
        <div class="standard_tile_line"></div>
        <div class="standard_list_entry">
            <div id="latest_comments_all">
                <div class="games_main_detail_comments_container">
                    <table class="standard_table_list_comments">
                    {if isset($type) and $type=='user'}  <!--user specific comments mode! -->
                        {if isset($comments)}
                        <tr>
                            <td width="100%" colspan="2">
                                <div class="standard_list_entry_news_text" style="text-align:center;">
                                    These are your latest game comments :
                                </div>
                            </td>
                        </tr>
                        {/if}
                    {/if}
                    {if isset($comments)}
                    {foreach from=$comments item=line}
                        <tr>
                            <td class="standard_table_left">
                                <span class="standard_tile_subtext" style="font-weight:bold;float:left;margin-left:5px;margin-right:5px;margin-top:15px;">
                                    <a href="../../admin/user/user_detail.php?user_id_selected={$line.user_id}">{$line.user_name}</a>
                                </span>
                                <span class="standard_tile_subtext" style="font-weight:bold;float:right;display:inline;margin-left:5px;margin-right:5px;margin-top:15px;">
                                    <a href="../games/games_detail.php?game_id={$line.game_id}">{$line.game}</a>
                                </span>
                                <div class="latest_comments_text">
                                    <div id="latest_comment_edit{$line.comment_id}"><div id="games_detail_review_main_text">{$line.comment}</div></div>
                                    <div style="width:100%;text-align:center;"><textarea id="comment_input{$line.comment_id}" class="latest_comments_textarea" style="display:none;" cols="80">{$line.comment_edit}</textarea></div>
                                </div>
                                {if isset($user_session)}
                                    <span style="font-weight:bold;float:left;margin-left:5px;margin-bottom:15px;">
                                    {if $user_session.user_id == $line.user_id}
                                        <a style="cursor: pointer;" onClick="CommentEditable({$line.comment_id},{$line.user_id})" class="latest_comments_link"><i class="fa fa-pencil" id="comment_edit_icon{$line.comment_id}" aria-hidden="true"  title="Click to edit comment"></i></a>
                                        <a style="cursor: pointer;" onClick="SaveEditable({$line.comment_id},{$line.user_id},{if (isset($type))}'user'{else}'normal'{/if})" class="latest_comments_link"><i class="fa fa-floppy-o" id="comment_save_icon{$line.comment_id}" aria-hidden="true" title="Click to save change" style="display:none;"></i></a>
                                        <a style="cursor: pointer;" onClick="DeleteEditable({$line.comment_id},{$line.user_id},{if (isset($type))}'user'{else}'normal'{/if})" class="latest_comments_link"><i class="fa fa-trash-o" id="comment_delete_icon{$line.comment_id}" aria-hidden="true" title="Click to delete comment"></i></a>
                                    {/if}
                                    {if $line.email != ''}
                                        <a href="mailto:{$line.email}?subject=Comment%20of%20{$line.game|escape:'url'}%20at%20Atari%20Legend" class="latest_comments_link" title="Click to email user"><i class="fa fa-envelope" aria-hidden="true"></i></a>
                                    {/if}
                                    {if $line.user_fb != ''}
                                        <a href="{$line.user_fb}" class="latest_comments_link" title="Click to visit Facebook profile"><i class="fa fa-facebook-square" aria-hidden="true"></i></a>
                                    {/if}
                                    {if $line.user_twitter != ''}
                                        <a href="{$line.user_twitter}" class="latest_comments_link" title="Click to visit Twitter profile"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                                    {/if}
                                    {if $line.user_af != ''}
                                        <a href="{$line.user_af}" class="latest_comments_link" title="Click to visit Atari-Forum profile"><i class="fa fa-gamepad" aria-hidden="true"></i></a>
                                    {/if}
                                    {if $line.user_website != ''}
                                        <a href="{$line.user_website}" class="latest_comments_link" title="Click to visit users website"><i class="fa fa-globe" aria-hidden="true"></i></a>
                                    {/if}
                                    </span>
                                {/if}
                                <span class="standard_tile_subtext" style="font-weight:bold;float:right;display:inline;margin-right:5px;margin-bottom:15px;">
                                    {$line.date}
                                </span>
                                <br><br>
                            </td>
                        </tr>
                    {/foreach}
                    {/if}
                    {if isset($type) and $type=='user'}
                        {if isset($comments)}
                        {else}
                        <tr>
                            <td width="100%">
                                <div class="standard_list_entry_news_text" style="text-align:center;">
                                    You haven't written any game comments. Browse the library, share some memories and upgrade your karma stats ;-)
                                </div>
                            </td>
                        </tr>
                        {/if}
                    {/if}
                    </table>
                </div>
            </div>
        </div>
    <div class="standard_tile_line"></div>
    </div>
{/if}
{/block}
